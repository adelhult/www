<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-20130316/Types.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE TypeFamilies #-}</font>
<font color=Blue>{-# LANGUAGE FlexibleInstances, FlexibleContexts #-}</font>
<u><font color="#804000">module</font></u> <font color=Green>Types</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>Prelude</font> hiding <font color="#808080">(</font>lookup<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font> <font color="#808080">(</font><font color="#808080">(</font><font color="#800080">&gt;=&gt;</font><font color="#808080">)</font><font color="#808080">)</font>

<font color=Blue>-- Code from the exam question:</font>
<u><font color="#804000">class</font></u> <font color=Green>GMapKey</font> k <u><font color="#804000">where</font></u>
  <u><font color="#804000">data</font></u> <font color=Green>GMap</font> k  <font color="#808080">::</font> <font color="#800080">*</font> <font color="#808080">-&gt;</font> <font color="#800080">*</font>
  empty        <font color="#808080">::</font> <font color=Green>GMap</font> k v
  lookup       <font color="#808080">::</font> k <font color="#808080">-&gt;</font> <font color=Green>GMap</font> k v <font color="#808080">-&gt;</font> <font color=Green>Maybe</font> v
  insert       <font color="#808080">::</font> k <font color="#808080">-&gt;</font> v <font color="#808080">-&gt;</font> <font color=Green>GMap</font> k v <font color="#808080">-&gt;</font> <font color=Green>GMap</font> k v

<u><font color="#804000">instance</font></u> <font color=Green>GMapKey</font> <font color=Green>()</font> <u><font color="#804000">where</font></u>
  <u><font color="#804000">data</font></u> <font color=Green>GMap</font> <font color=Green>()</font> v       <font color="#808080">=</font> <font color=Green>GMU</font> <font color="#808080">(</font><font color=Green>Maybe</font> v<font color="#808080">)</font>
  empty                <font color="#808080">=</font> <font color=Green>GMU</font> <font color=Green>Nothing</font>
  lookup <font color=Green>()</font> <font color="#808080">(</font><font color=Green>GMU</font> mv<font color="#808080">)</font>   <font color="#808080">=</font> mv
  insert <font color=Green>()</font> v <font color="#808080">(</font><font color=Green>GMU</font> <u><font color="#804000">_</font></u><font color="#808080">)</font>  <font color="#808080">=</font> <font color=Green>GMU</font> <font color="#800080">$</font> <font color=Green>Just</font> v

<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>GMapKey</font> a<font color="#808080">,</font> <font color=Green>GMapKey</font> b<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>GMapKey</font> <font color="#808080">(</font><font color=Green>Either</font> a b<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  <u><font color="#804000">data</font></u> <font color=Green>GMap</font> <font color="#808080">(</font><font color=Green>Either</font> a b<font color="#808080">)</font> v           <font color="#808080">=</font> <font color=Green>GME</font> <font color="#808080">(</font><font color=Green>GMap</font> a v<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>GMap</font> b v<font color="#808080">)</font>
  empty                              <font color="#808080">=</font> <font color=Green>GME</font> empty empty
  lookup <font color="#808080">(</font><font color=Green>Left</font>  a<font color="#808080">)</font>  <font color="#808080">(</font><font color=Green>GME</font> gm1  <b><font color=Magenta>_gm2</font></b><font color="#808080">)</font>  <font color="#808080">=</font> lookup a gm1
  lookup <font color="#808080">(</font><font color=Green>Right</font> b<font color="#808080">)</font>  <font color="#808080">(</font><font color=Green>GME</font> <b><font color=Magenta>_gm1</font></b> gm2 <font color="#808080">)</font>  <font color="#808080">=</font> lookup b gm2
  insert <font color="#808080">(</font><font color=Green>Left</font>  a<font color="#808080">)</font>  v <font color="#808080">(</font><font color=Green>GME</font> gm1 gm2<font color="#808080">)</font>  <font color="#808080">=</font> <font color=Green>GME</font> <font color="#808080">(</font>insert a v gm1<font color="#808080">)</font> gm2
  insert <font color="#808080">(</font><font color=Green>Right</font> a<font color="#808080">)</font>  v <font color="#808080">(</font><font color=Green>GME</font> gm1 gm2<font color="#808080">)</font>  <font color="#808080">=</font> <font color=Green>GME</font> gm1 <font color="#808080">(</font>insert a v gm2<font color="#808080">)</font>

<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>GMapKey</font> a<font color="#808080">,</font> <font color=Green>GMapKey</font> b<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>GMapKey</font> <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  <u><font color="#804000">data</font></u> <font color=Green>GMap</font> <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font> v        <font color="#808080">=</font> <font color=Green>GMP</font> <font color="#808080">(</font><font color=Green>GMap</font> a <font color="#808080">(</font><font color=Green>GMap</font> b v<font color="#808080">)</font><font color="#808080">)</font>
  empty                     <font color="#808080">=</font> <font color=Green>GMP</font> empty
  lookup <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>GMP</font> gm<font color="#808080">)</font>    <font color="#808080">=</font> lookupGMP a b gm          <font color=Blue>-- TODO</font>
  insert <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font> v <font color="#808080">(</font><font color=Green>GMP</font> gm<font color="#808080">)</font>  <font color="#808080">=</font> <font color=Green>GMP</font> <font color="#808080">(</font>insertGMP a b v gm<font color="#808080">)</font>  <font color=Blue>-- TODO</font>

<font color=Blue>{- Part 3 (a): Fully expand the type family application
|GMap (Either () (Bit, a)) v|. You may ignore the constructors |GMU|,
|GME| and |GMP| as I did in the comment after type signature for |t0|.

----

  GMap (Either () (Bit, a)) v
~= {- instance for Either -}
  (GMap () v, GMap (Bit, a) v)
~= {- instances for () and (,) -}
  (Maybe v, GMap Bit (GMap a v))
~= {- expand type synonym Bit -}
  (Maybe v, GMap (Either () ()) (GMap a v))
~= {- instance for Either -}
  (Maybe v, (GMap () (GMap a v), (GMap () (GMap a v))))
~= {- instance for (), twice -}
  (Maybe v, (Maybe (GMap a v), Maybe (GMap a v)))

-}</font>

<font color=Blue>-- ----------------</font>

<font color=Blue>{- Task 3 (b): Give the type signatures for and implement |lookupGMP|
and |insertGMP|. -}</font>

lookupGMP <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>GMapKey</font> a<font color="#808080">,</font> <font color=Green>GMapKey</font> b<font color="#808080">)</font> <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font> b <font color="#808080">-&gt;</font> <font color=Green>GMap</font> a <font color="#808080">(</font><font color=Green>GMap</font> b v<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Maybe</font> v
lookupGMP a b <font color="#808080">=</font> lookup a <font color="#800080">&gt;=&gt;</font> lookup b

insertGMP <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>GMapKey</font> a<font color="#808080">,</font> <font color=Green>GMapKey</font> b<font color="#808080">)</font> <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font> b <font color="#808080">-&gt;</font> v <font color="#808080">-&gt;</font>
             <font color=Green>GMap</font> a <font color="#808080">(</font><font color=Green>GMap</font> b v<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>GMap</font> a <font color="#808080">(</font><font color=Green>GMap</font> b v<font color="#808080">)</font>
insertGMP a b v gm <font color="#808080">=</font> insert a <font color="#808080">(</font>insert b v innermap<font color="#808080">)</font> gm
  <u><font color="#804000">where</font></u> innermap <font color="#808080">=</font> lookupDef empty a gm

lookupDef <font color="#808080">::</font> <font color=Green>GMapKey</font> k <font color="#808080">=&gt;</font> v <font color="#808080">-&gt;</font> k <font color="#808080">-&gt;</font> <font color=Green>GMap</font> k v <font color="#808080">-&gt;</font> v
lookupDef def k <font color="#808080">=</font> maybe def id <font color="#800080">.</font> lookup k


<font color=Blue>-- ----------------------------------------------------------------</font>

<font color=Blue>{- Task 3 (c): Give type signatures for and implement |fmapGMU|,
|fmapGME| and |fmapGMP|. -}</font>

<font color=Blue>-- Code from the exam question:</font>
<u><font color="#804000">instance</font></u> <font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> <font color=Green>()</font><font color="#808080">)</font> <u><font color="#804000">where</font></u>
  fmap <font color="#808080">=</font> fmapGMU

<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> a<font color="#808080">)</font><font color="#808080">,</font> <font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> b<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font>
         <font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> <font color="#808080">(</font><font color=Green>Either</font> a b<font color="#808080">)</font><font color="#808080">)</font> <u><font color="#804000">where</font></u>
  fmap <font color="#808080">=</font> fmapGME

<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> a<font color="#808080">)</font><font color="#808080">,</font> <font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> b<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font>
         <font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font><font color="#808080">)</font> <u><font color="#804000">where</font></u>
  fmap <font color="#808080">=</font> fmapGMP

<font color=Blue>-- Answer:</font>

fmapGMU <font color="#808080">::</font> <font color="#808080">(</font>a<font color="#808080">-&gt;</font>b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>GMap</font> <font color=Green>()</font> a <font color="#808080">-&gt;</font> <font color=Green>GMap</font> <font color=Green>()</font> b
fmapGMU f <font color="#808080">(</font><font color=Green>GMU</font> ma<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>GMU</font> <font color="#800080">$</font> fmap f ma
<font color=Blue>-- the inner fmap is for Maybe</font>

fmapGME <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> c<font color="#808080">)</font><font color="#808080">,</font> <font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> d<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font>
           <font color="#808080">(</font>a<font color="#808080">-&gt;</font>b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>GMap</font> <font color="#808080">(</font><font color=Green>Either</font> c d<font color="#808080">)</font> a <font color="#808080">-&gt;</font> <font color=Green>GMap</font> <font color="#808080">(</font><font color=Green>Either</font> c d<font color="#808080">)</font> b
fmapGME f <font color="#808080">(</font><font color=Green>GME</font> gma gmb<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>GME</font> <font color="#808080">(</font>fmap f gma<font color="#808080">)</font> <font color="#808080">(</font>fmap f gmb<font color="#808080">)</font>

fmapGMP <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> c<font color="#808080">)</font><font color="#808080">,</font> <font color=Green>Functor</font> <font color="#808080">(</font><font color=Green>GMap</font> d<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font>
           <font color="#808080">(</font>a<font color="#808080">-&gt;</font>b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>GMap</font> <font color="#808080">(</font>c<font color="#808080">,</font> d<font color="#808080">)</font> a <font color="#808080">-&gt;</font> <font color=Green>GMap</font> <font color="#808080">(</font>c<font color="#808080">,</font> d<font color="#808080">)</font> b
fmapGMP f <font color="#808080">(</font><font color=Green>GMP</font> gmab<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>GMP</font> <font color="#800080">$</font> fmap <font color="#808080">(</font>fmap f<font color="#808080">)</font> gmab
</pre>
</body>
</html>