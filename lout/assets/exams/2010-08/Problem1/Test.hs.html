<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-20100824/Problem1/Test.hs</title>
</head>
<body>
<pre><u><font color="#804000">module</font></u> <font color=Green>Problem1</font><font color="#800080">.</font><font color=Green>Test</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font> <u><font color="#804000">as</font></u> <font color=Green>CMS</font><font color="#808080">(</font><font color=Green>StateT</font><font color="#808080">,</font> runStateT<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Error</font> <u><font color="#804000">as</font></u> <font color=Green>CME</font><font color=Green>()</font>
<u><font color="#804000">import</font></u> <font color=Green>Problem1</font><font color="#800080">.</font><font color=Green>Types</font><font color="#808080">(</font><font color=Green>Err</font><font color="#808080">,</font> <font color=Green>Value</font><font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Problem1</font> <font color=Blue>-- (C(..), BOp(..), UOp(..), NullOp(..), eval)</font>

<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Testing code:</font>
<font color=Blue>-- run' ::                  CalcM Value -&gt; Either Err Value</font>
run' <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Num</font> s<font color="#808080">,</font> <font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>StateT</font> s m v <font color="#808080">-&gt;</font> m v
run' mv <font color="#808080">=</font> <u><font color="#804000">do</font></u> 
  <font color="#808080">(</font>result<font color="#808080">,</font> mem<font color="#808080">)</font> <font color="#808080">&lt;-</font> <font color=Green>CMS</font><font color="#800080">.</font>runStateT mv <font color=Magenta>0</font>
  return result          

<font color=Blue>-- run ::                        Calc -&gt; Either Err Value</font>
run <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Fractional</font> v<font color="#808080">,</font> <font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>C</font> v <font color="#808080">-&gt;</font> m v
run <font color="#808080">=</font> run' <font color="#800080">.</font> eval

<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Some instances just for fun</font>
<u><font color="#804000">instance</font></u> <font color=Green>Monad</font> <font color=Green>C</font> <u><font color="#804000">where</font></u>
  return <font color="#808080">=</font> returnC
  <font color="#808080">(</font><font color="#800080">&gt;&gt;=</font><font color="#808080">)</font>  <font color="#808080">=</font> bindC
  fail   <font color="#808080">=</font> failC

returnC <font color="#808080">::</font> a <font color="#808080">-&gt;</font> <font color=Green>C</font> a
returnC <font color="#808080">=</font> <font color=Green>Num</font>

bindC <font color="#808080">::</font> <font color=Green>C</font> a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color=Green>C</font> b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>C</font> b
bindC <font color="#808080">(</font><font color=Green>CBin</font>  op e1 e2<font color="#808080">)</font> f  <font color="#808080">=</font>  <font color=Green>CBin</font>  op <font color="#808080">(</font>bindC e1 f<font color="#808080">)</font> <font color="#808080">(</font>bindC e2 f<font color="#808080">)</font>
bindC <font color="#808080">(</font><font color=Green>CUn</font>   op e<font color="#808080">)</font>     f  <font color="#808080">=</font>  <font color=Green>CUn</font>   op <font color="#808080">(</font>bindC e f<font color="#808080">)</font>
bindC <font color="#808080">(</font><font color=Green>CNull</font> op<font color="#808080">)</font>       f  <font color="#808080">=</font>  <font color=Green>CNull</font> op
bindC <font color="#808080">(</font><font color=Green>Num</font> a<font color="#808080">)</font>          f  <font color="#808080">=</font>  f a

failC <font color="#808080">::</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>C</font> a
failC err <font color="#808080">=</font> error <font color="#808080">(</font><font color=Magenta>"failC: "</font><font color="#800080">++</font>err<font color="#808080">)</font> 
<font color=Blue>-- a Fail constructor is missing to completely implement the Haskell Monad class</font>

<u><font color="#804000">instance</font></u> <font color=Green>Num</font> a <font color="#808080">=&gt;</font> <font color=Green>Num</font> <font color="#808080">(</font><font color=Green>C</font> a<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  <font color="#808080">(</font><font color="#800080">+</font><font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>CBin</font> <font color=Green>Add</font>
  <font color="#808080">(</font><font color=Blue>-</font><font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>CBin</font> <font color=Green>Sub</font>
  <font color="#808080">(</font><font color="#800080">*</font><font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>CBin</font> <font color=Green>Mul</font>
  fromInteger <font color="#808080">=</font> <font color=Green>Num</font> <font color="#800080">.</font> fromInteger
  abs    <font color="#808080">=</font> error <font color=Magenta>"C has no abs constructor"</font>
  signum <font color="#808080">=</font> error <font color=Magenta>"C has no signum constructor"</font>

<u><font color="#804000">instance</font></u> <font color=Green>Fractional</font> a <font color="#808080">=&gt;</font> <font color=Green>Fractional</font> <font color="#808080">(</font><font color=Green>C</font> a<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  <font color="#808080">(</font><font color="#800080">/</font><font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>CBin</font> <font color=Green>Div</font>
  fromRational <font color="#808080">=</font> <font color=Green>Num</font> <font color="#800080">.</font> fromRational

m <font color="#808080">::</font> <font color=Green>C</font> v <font color="#808080">-&gt;</font> <font color=Green>C</font> v
m  <font color="#808080">=</font> <font color=Green>CUn</font> <font color=Green>M</font>
mr <font color="#808080">::</font> <font color=Green>C</font> v
mr <font color="#808080">=</font> <font color=Green>CNull</font> <font color=Green>MR</font>

<font color=Blue>-- e1, e2, e3 :: Calc</font>
e1 <font color="#808080">::</font> <font color=Green>Num</font> t <font color="#808080">=&gt;</font> t
e1 <font color="#808080">=</font> <font color=Magenta>1</font> <font color="#800080">+</font> <font color=Magenta>2</font><font color="#800080">*</font><font color=Magenta>3</font>
e2 <font color="#808080">::</font> <font color=Green>Num</font> v <font color="#808080">=&gt;</font> <font color=Green>C</font> v
e2 <font color="#808080">=</font> <font color=Magenta>6</font><font color="#800080">*</font><font color=Magenta>2</font> <font color=Blue>-</font> m <font color="#808080">(</font><font color=Magenta>1</font><font color="#800080">*</font><font color=Magenta>3</font><font color="#808080">)</font>
e3 <font color="#808080">::</font> <font color=Green>Fractional</font> v <font color="#808080">=&gt;</font> <font color=Green>C</font> v
e3 <font color="#808080">=</font> e2<font color="#800080">/</font>mr 

<font color=Blue>-- test1, test2, test3 :: Either Err Value</font>
test1<font color="#808080">,</font> test2<font color="#808080">,</font> test3 <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Fractional</font> v<font color="#808080">,</font> <font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> m v
test1 <font color="#808080">=</font> run e1
test2 <font color="#808080">=</font> run e2
test3 <font color="#808080">=</font> run e3


prop_sanity <font color="#808080">::</font> <font color=Green>Fractional</font> v <font color="#808080">=&gt;</font> <font color=Green>C</font> v <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
prop_sanity e <font color="#808080">=</font> run <font color="#808080">(</font>m e <font color="#800080">/</font> mr<font color="#808080">)</font> <font color="#800080">==</font> <font color="#808080">(</font><font color=Green>Right</font> <font color=Magenta>1</font> <font color="#808080">::</font> <font color=Green>Num</font> v <font color="#808080">=&gt;</font> <font color=Green>Either</font> <font color=Green>Err</font> v<font color="#808080">)</font>

main <font color="#808080">::</font> <font color=Green>IO</font> <font color=Green>()</font>
main <font color="#808080">=</font> print <font color="#808080">(</font><font color="#808080">[</font>test1<font color="#808080">,</font> test2<font color="#808080">,</font> test3<font color="#808080">,</font> run <font color="#808080">(</font><font color=Magenta>1</font><font color="#800080">/</font><font color=Magenta>0</font><font color="#808080">)</font><font color="#808080">]</font> <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Either</font> <font color=Green>Err</font> <font color=Green>Value</font><font color="#808080">]</font><font color="#808080">)</font>


<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Left-overs</font>

<font color=Blue>{-
data Calc = CBin BOp Calc Calc 
          | CUn UOp Calc 
          | CNull NullOp 
          | Num Integer 
  deriving (Eq, Show)
-}</font>
<font color=Blue>-- data Button = BDig Char | BBin BOp | BUn UOp | BNull NullOp    deriving (Eq, Show)</font>
</pre>
</body>
</html>