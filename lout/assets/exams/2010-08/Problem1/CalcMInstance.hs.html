<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-20100824/Problem1/CalcMInstance.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE TypeSynonymInstances, MultiParamTypeClasses #-}</font>
<u><font color="#804000">module</font></u> <font color=Green>Problem1</font><font color="#800080">.</font><font color=Green>CalcMInstance</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font> <u><font color="#804000">as</font></u> <font color=Green>CMS</font> <font color="#808080">(</font><font color=Green>MonadState</font><font color="#808080">,</font> get<font color="#808080">,</font> put<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Problem1</font><font color="#800080">.</font><font color=Green>Types</font>
<u><font color="#804000">newtype</font></u> <font color=Green>StateT</font> s m a <font color="#808080">=</font> <font color=Green>StateT</font> <font color="#808080">{</font>runStateT <font color="#808080">::</font> s <font color="#808080">-&gt;</font> m <font color="#808080">(</font>a<font color="#808080">,</font> s<font color="#808080">)</font><font color="#808080">}</font>
<u><font color="#804000">type</font></u> <font color=Green>CalcM</font> <font color="#808080">=</font> <font color=Green>StateT</font> <font color=Green>Mem</font> <font color="#808080">(</font><font color=Green>Either</font> <font color=Green>Err</font><font color="#808080">)</font>

<u><font color="#804000">instance</font></u> <font color=Green>Monad</font> <font color=Green>CalcM</font> <u><font color="#804000">where</font></u> return <font color="#808080">=</font> returnM<font color="#808080">;</font> <font color="#808080">(</font><font color="#800080">&gt;&gt;=</font><font color="#808080">)</font>  <font color="#808080">=</font> bindM<font color="#808080">;</font> fail   <font color="#808080">=</font> failM<font color="#808080">;</font> 

returnM <font color="#808080">::</font> a <font color="#808080">-&gt;</font> <font color=Green>CalcM</font> a
returnM a <font color="#808080">=</font> <font color=Green>StateT</font> <font color="#808080">(</font><font color="#808080">\</font>s<font color="#808080">-&gt;</font> <font color=Green>Right</font> <font color="#808080">(</font>a<font color="#808080">,</font> s<font color="#808080">)</font><font color="#808080">)</font>

bindM <font color="#808080">::</font> <font color=Green>CalcM</font> a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color=Green>CalcM</font> b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>CalcM</font> b
bindM mx f <font color="#808080">=</font> <font color=Green>StateT</font> <font color="#800080">$</font> <font color="#808080">\</font>s<font color="#808080">-&gt;</font> <u><font color="#804000">do</font></u> <font color=Blue>-- for the (inner) error monad</font>
  <font color="#808080">(</font>a<font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">&lt;-</font> runStateT mx s 
  runStateT <font color="#808080">(</font>f a<font color="#808080">)</font> s'

failM <font color="#808080">::</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>CalcM</font> a
failM err <font color="#808080">=</font> <font color=Green>StateT</font> <font color="#808080">(</font><font color="#808080">\</font>s<font color="#808080">-&gt;</font> fail err<font color="#808080">)</font>

<u><font color="#804000">instance</font></u> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> <font color=Green>Mem</font> <font color="#808080">(</font><font color=Green>CalcM</font><font color="#808080">)</font> <u><font color="#804000">where</font></u> get <font color="#808080">=</font> getM<font color="#808080">;</font> put <font color="#808080">=</font> putM<font color="#808080">;</font>

getM <font color="#808080">::</font> <font color=Green>CalcM</font> <font color=Green>Mem</font>
getM <font color="#808080">=</font> <font color=Green>StateT</font> <font color="#800080">$</font> <font color="#808080">\</font>s<font color="#808080">-&gt;</font> return <font color="#808080">(</font>s<font color="#808080">,</font> s<font color="#808080">)</font>

putM <font color="#808080">::</font> <font color=Green>Mem</font> <font color="#808080">-&gt;</font> <font color=Green>CalcM</font> <font color=Green>()</font>
putM m <font color="#808080">=</font> <font color=Green>StateT</font> <font color="#800080">$</font> <font color="#808080">\</font>s <font color="#808080">-&gt;</font> return <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font> m<font color="#808080">)</font>
</pre>
</body>
</html>