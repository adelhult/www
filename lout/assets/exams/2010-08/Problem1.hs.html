<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-20100824/Problem1.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE FlexibleContexts, FlexibleInstances #-}</font>
<font color=Blue>-- {-# LANGUAGE NoMonomorphismRestriction #-}</font>
<u><font color="#804000">module</font></u> <font color=Green>Problem1</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font> <u><font color="#804000">as</font></u> <font color=Green>CMS</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Error</font> <u><font color="#804000">as</font></u> <font color=Green>CME</font>
<u><font color="#804000">import</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font>
<u><font color="#804000">import</font></u> <font color=Green>Problem1</font><font color="#800080">.</font><font color=Green>Types</font>
<font color=Blue>-- Problem1: a) Define Calc and eval</font>

<font color=Blue>-- This solution abstracts a bit from the exam question, generalising</font>
<font color=Blue>-- the type in the Num constructor from Integer to a and from CalcM to</font>
<font color=Blue>-- some MonadState. This is not needed to pass. (The monomorphic types</font>
<font color=Blue>-- are shown in comments - they can be more intuitive than the</font>
<font color=Blue>-- generalised polymorphic types.)</font>

<u><font color="#804000">type</font></u> <font color=Green>Calc</font> <font color="#808080">=</font> <font color=Green>C</font> <font color=Green>Value</font>
<u><font color="#804000">data</font></u> <font color=Green>C</font> a <font color="#808080">=</font> <font color=Green>CBin</font> <font color=Green>BOp</font> <font color="#808080">(</font><font color=Green>C</font> a<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>C</font> a<font color="#808080">)</font> 
         <font color="#808080">|</font> <font color=Green>CUn</font>  <font color=Green>UOp</font> <font color="#808080">(</font><font color=Green>C</font> a<font color="#808080">)</font> 
         <font color="#808080">|</font> <font color=Green>CNull</font> <font color=Green>NullOp</font> 
         <font color="#808080">|</font> <font color=Green>Num</font> a                    <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Eq</font><font color="#808080">,</font> <font color=Green>Show</font><font color="#808080">)</font>
<u><font color="#804000">data</font></u> <font color=Green>BOp</font>    <font color="#808080">=</font> <font color=Green>Add</font> <font color="#808080">|</font> <font color=Green>Sub</font> <font color="#808080">|</font> <font color=Green>Mul</font> <font color="#808080">|</font> <font color=Green>Div</font> <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Eq</font><font color="#808080">,</font> <font color=Green>Show</font><font color="#808080">)</font>
<u><font color="#804000">data</font></u> <font color=Green>UOp</font>    <font color="#808080">=</font> <font color=Green>Inv</font> <font color="#808080">|</font> <font color=Green>Neg</font>   <font color="#808080">|</font> <font color=Green>M</font> <font color="#808080">|</font> <font color=Green>MP</font>  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Eq</font><font color="#808080">,</font> <font color=Green>Show</font><font color="#808080">)</font>
<u><font color="#804000">data</font></u> <font color=Green>NullOp</font> <font color="#808080">=</font> <font color=Green>MR</font> <font color="#808080">|</font> <font color=Green>MC</font>               <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Eq</font><font color="#808080">,</font> <font color=Green>Show</font><font color="#808080">)</font>

<font color=Blue>-- eval :: Calc -&gt; CalcM Value</font>
eval <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> v m<font color="#808080">,</font> <font color=Green>Fractional</font> v<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>C</font> v <font color="#808080">-&gt;</font> m v
eval <font color="#808080">(</font><font color=Green>CBin</font> op e1 e2<font color="#808080">)</font> <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  v1 <font color="#808080">&lt;-</font> eval e1
  v2 <font color="#808080">&lt;-</font> eval e2
  evalBOp op v1 v2

eval <font color="#808080">(</font><font color=Green>CUn</font> op e<font color="#808080">)</font> <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  v <font color="#808080">&lt;-</font> eval e
  evalUOp op v

eval <font color="#808080">(</font><font color=Green>CNull</font> op<font color="#808080">)</font> <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  evalNullOp op

eval <font color="#808080">(</font><font color=Green>Num</font> n<font color="#808080">)</font>    <font color="#808080">=</font> return n
<font color=Blue>--  return (fromInteger n) was used before the generalisation</font>

<font color=Blue>-- evalBOp :: BOp -&gt; Value -&gt; Value -&gt; CalcM Value</font>
evalBOp <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Fractional</font> v<font color="#808080">,</font> <font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>BOp</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>v<font color="#808080">-&gt;</font>v<font color="#808080">-&gt;</font>m v<font color="#808080">)</font>
evalBOp <font color=Green>Div</font> v1 <font color=Magenta>0</font> <font color="#808080">=</font> fail <font color=Magenta>"DivZ"</font>
evalBOp op v1 v2 <font color="#808080">=</font> return <font color="#800080">$</font> evalBOpPure op v1 v2

<font color=Blue>-- evalBOpPure :: BOp -&gt; Value -&gt; Value -&gt; Value</font>
evalBOpPure <font color="#808080">::</font> <font color=Green>Fractional</font> v <font color="#808080">=&gt;</font> <font color=Green>BOp</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>v<font color="#808080">-&gt;</font>v<font color="#808080">-&gt;</font>v<font color="#808080">)</font>
evalBOpPure <font color=Green>Div</font> <font color="#808080">=</font> <font color="#808080">(</font><font color="#800080">/</font><font color="#808080">)</font>
evalBOpPure <font color=Green>Mul</font> <font color="#808080">=</font> <font color="#808080">(</font><font color="#800080">*</font><font color="#808080">)</font>
evalBOpPure <font color=Green>Add</font> <font color="#808080">=</font> <font color="#808080">(</font><font color="#800080">+</font><font color="#808080">)</font>
evalBOpPure <font color=Green>Sub</font> <font color="#808080">=</font> <font color="#808080">(</font><font color=Blue>-</font><font color="#808080">)</font>

<font color=Blue>----------------</font>
<font color=Blue>-- evalUOp :: UOp -&gt; v -&gt; CM v v</font>
evalUOp <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Fractional</font> v<font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> v m<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>UOp</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>v<font color="#808080">-&gt;</font>m v<font color="#808080">)</font>
evalUOp <font color=Green>Inv</font> <font color=Magenta>0</font> <font color="#808080">=</font> fail <font color=Magenta>"InvZ"</font>
evalUOp <font color=Green>M</font>   v <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  putMem v
evalUOp <font color=Green>MP</font>  v <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  m <font color="#808080">&lt;-</font> getMem
  putMem <font color="#808080">(</font>v<font color="#800080">+</font>m<font color="#808080">)</font>
evalUOp op  v <font color="#808080">=</font> return <font color="#800080">$</font> evalUOpPure op v

<font color=Blue>-- evalUOpPure :: UOp -&gt; Value -&gt; Value</font>
evalUOpPure <font color="#808080">::</font> <font color=Green>Fractional</font> v <font color="#808080">=&gt;</font> <font color=Green>UOp</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>v<font color="#808080">-&gt;</font>v<font color="#808080">)</font>
evalUOpPure <font color=Green>Inv</font> <font color="#808080">=</font> <font color="#808080">(</font><font color=Magenta>1</font><font color="#800080">/</font><font color="#808080">)</font>
evalUOpPure <font color=Green>Neg</font> <font color="#808080">=</font> negate

<font color=Blue>----------------</font>

<font color=Blue>-- evalNullOp :: NullOp -&gt; CalcM Value</font>
evalNullOp <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Num</font> v<font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> v m<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>NullOp</font> <font color="#808080">-&gt;</font> m v
evalNullOp <font color=Green>MR</font> <font color="#808080">=</font> getMem
evalNullOp <font color=Green>MC</font> <font color="#808080">=</font> putMem <font color=Magenta>0</font>

<font color=Blue>----------------</font>
<font color=Blue>-- getMem :: CalcM Value</font>
getMem <font color="#808080">::</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> v m <font color="#808080">=&gt;</font> m v
getMem    <font color="#808080">=</font> <font color=Green>CMS</font><font color="#800080">.</font>get

<font color=Blue>-- putMem :: Value -&gt; CalcM Value</font>
putMem <font color="#808080">::</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> v m <font color="#808080">=&gt;</font> v <font color="#808080">-&gt;</font> m v
putMem m <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  <font color=Green>CMS</font><font color="#800080">.</font>put m
  return m

<font color=Blue>-- End of Problem1: a)</font>

<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Problem1 b) Define CalcM + MonadState operations</font>

<font color=Blue>-- Alt. b1) Use imported Control.Monad.State and Control.Monad.Error:</font>
<u><font color="#804000">type</font></u> <font color=Green>CM</font> v <font color="#808080">=</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>StateT</font> v <font color="#808080">(</font><font color=Green>Either</font> <font color=Green>Err</font><font color="#808080">)</font>
<u><font color="#804000">type</font></u> <font color=Green>CalcM</font> <font color="#808080">=</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>StateT</font> <font color=Green>Mem</font> <font color="#808080">(</font><font color=Green>Either</font> <font color=Green>Err</font><font color="#808080">)</font>
<font color=Blue>-- All instances are automatic in this alternative</font>

<font color=Blue>-- Alt. b2) Define your own: see Problem1.CalcMInstance</font>

<font color=Blue>-- End of Problem1: b)</font>

<font color=Blue>---------------------------------------------------------------</font>
<font color=Blue>-- Problem1: c) Define the Monad laws as QC prop.s</font>

<font color=Blue>----------------</font>
<font color=Blue>-- Monad laws</font>

<font color=Blue>-- Polymorphic:</font>
leftId <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Monad</font> m<font color="#808080">,</font> <font color=Green>Eq</font> <font color="#808080">(</font>m b<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">-&gt;</font>m b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
leftId a f   <font color="#808080">=</font>  <font color="#808080">(</font>return a <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>x <font color="#808080">-&gt;</font> f x<font color="#808080">)</font> <font color="#800080">==</font> f a

rightId <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Monad</font> m<font color="#808080">,</font> <font color=Green>Eq</font> <font color="#808080">(</font>m a<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font> m a <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
rightId m    <font color="#808080">=</font>  <font color="#808080">(</font>m <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>x<font color="#808080">-&gt;</font> return x<font color="#808080">)</font> <font color="#800080">==</font> m

assoc <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Monad</font> m<font color="#808080">,</font> <font color=Green>Eq</font> <font color="#808080">(</font>m c<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font> m a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">-&gt;</font>m b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>b<font color="#808080">-&gt;</font> m c<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
assoc m f g  <font color="#808080">=</font>  <font color="#808080">(</font><font color="#808080">(</font>m <font color="#800080">&gt;&gt;=</font> f<font color="#808080">)</font> <font color="#800080">&gt;&gt;=</font> g<font color="#808080">)</font>  <font color="#800080">==</font>   <font color="#808080">(</font>m <font color="#800080">&gt;&gt;=</font> <font color="#808080">(</font><font color="#808080">\</font>x<font color="#808080">-&gt;</font> f x <font color="#800080">&gt;&gt;=</font> g<font color="#808080">)</font><font color="#808080">)</font>

<font color=Blue>-- End of Problem1: c)</font>

<font color=Blue>-- Problem1: d) running tests?</font>

<font color=Blue>-- For CalcM:</font>
leftIdCM <font color="#808080">::</font>  <font color="#808080">(</font><font color=Green>Arbitrary</font> a<font color="#808080">,</font> <font color=Green>Arbitrary</font> <font color="#808080">(</font><font color=Green>CalcM</font> a<font color="#808080">)</font><font color="#808080">,</font> <font color=Green>Eq</font> <font color="#808080">(</font><font color=Green>CalcM</font> b<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font> 
             a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">-&gt;</font><font color=Green>CalcM</font> b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
leftIdCM  <font color="#808080">=</font>  leftId

rightIdCM <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Arbitrary</font> <font color="#808080">(</font><font color=Green>CalcM</font> a<font color="#808080">)</font><font color="#808080">,</font> <font color=Green>Eq</font> <font color="#808080">(</font><font color=Green>CalcM</font> a<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>CalcM</font> a <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
rightIdCM  <font color="#808080">=</font> rightId

assocCM <font color="#808080">::</font>   <font color="#808080">(</font><font color=Green>Arbitrary</font> a<font color="#808080">,</font> <font color=Green>Arbitrary</font> <font color="#808080">(</font><font color=Green>CalcM</font> a<font color="#808080">)</font><font color="#808080">,</font> <font color=Green>Arbitrary</font> <font color="#808080">(</font><font color=Green>CalcM</font> b<font color="#808080">)</font><font color="#808080">,</font> <font color=Green>Eq</font> <font color="#808080">(</font><font color=Green>CalcM</font> c<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">=&gt;</font>
             <font color=Green>CalcM</font> a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">-&gt;</font><font color=Green>CalcM</font> b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>b<font color="#808080">-&gt;</font> <font color=Green>CalcM</font> c<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
assocCM  <font color="#808080">=</font>  assoc

<font color=Blue>{- You would also need to 
* fix monomorphic types for a, b, c
* define generators for CalcM a
* define equality checks for CalcM a values

Equality checking of arbitrary functions is undecidable. This can be
solved by letting QuickCheck generate random start-states and test
equality after running the CalcM monad.

-}</font>

<font color=Blue>-- End of Problem1: d)</font>
</pre>
</body>
</html>