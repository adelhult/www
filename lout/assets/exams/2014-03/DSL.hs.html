<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-2014-03/DSL.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE GADTs #-}</font>
<u><font color="#804000">module</font></u> <font color=Green>DSL</font> <u><font color="#804000">where</font></u>

<font color=Blue>-- data C -- To be defined</font>
<font color=Blue>-- Primitive operations</font>
inv    <font color="#808080">::</font> <font color=Green>C</font>   <font color="#808080">-&gt;</font> <font color=Green>C</font>      <font color=Blue>-- inverter (``not''-gate)</font>
ands   <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>C</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>C</font>      <font color=Blue>-- ``and''-gate with zero or more inputs and one output </font>
delay  <font color="#808080">::</font> <font color=Green>C</font>   <font color="#808080">-&gt;</font> <font color=Green>C</font>      <font color=Blue>-- delay the output one step</font>
<font color=Blue>-- Derived operations</font>
ors    <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>C</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>C</font>      <font color=Blue>-- ``or''-gate with zero or more inputs and one output</font>
xor    <font color="#808080">::</font> <font color=Green>C</font> <font color="#808080">-&gt;</font> <font color=Green>C</font> <font color="#808080">-&gt;</font> <font color=Green>C</font>   <font color=Blue>-- binary ``xor''-gate</font>
false<font color="#808080">,</font> true<font color="#808080">,</font> toggle <font color="#808080">::</font> <font color=Green>C</font>
<font color=Blue>-- Run functions</font>
run    <font color="#808080">::</font> <font color=Green>C</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font><font color=Green>Bool</font><font color="#808080">]</font>
<font color=Blue>-- show   :: C -&gt; String -- Not asked for, but could be derived.</font>

<font color=Blue>-- Here is a selection of the properties it should satisfy:</font>

prop_inv    i c  <font color="#808080">=</font>  run <font color="#808080">(</font>inv c<font color="#808080">)</font> <font color="#800080">!!</font> i  <font color="#800080">/=</font>  run c <font color="#800080">!!</font> i

prop_delay0   c  <font color="#808080">=</font>  not <font color="#808080">(</font>run <font color="#808080">(</font>delay c<font color="#808080">)</font> <font color="#800080">!!</font> <font color=Magenta>0</font><font color="#808080">)</font>
prop_delay  i c  <font color="#808080">=</font>  run <font color="#808080">(</font>delay c<font color="#808080">)</font> <font color="#800080">!!</font> <font color="#808080">(</font>i<font color="#800080">+</font><font color=Magenta>1</font><font color="#808080">)</font>  <font color="#800080">==</font>  run c <font color="#800080">!!</font> i

prop_true   i    <font color="#808080">=</font>  run true <font color="#800080">!!</font> i

prop_toggle i    <font color="#808080">=</font>  run toggle <font color="#800080">!!</font> i  <font color="#800080">==</font>  <font color="#808080">(</font>i <font color="#800080">`mod`</font> <font color=Magenta>2</font> <font color="#800080">==</font> <font color=Magenta>1</font><font color="#808080">)</font>

<font color=Blue>-- DLS a) Implement the derived operations while keeping the type |C|</font>
<font color=Blue>-- abstract.</font>

ors <font color="#808080">=</font> inv <font color="#800080">.</font> ands <font color="#800080">.</font> map inv

xor c1 c2 <font color="#808080">=</font> ands <font color="#808080">[</font>ors <font color="#808080">[</font>c1<font color="#808080">,</font> c2<font color="#808080">]</font><font color="#808080">,</font> inv <font color="#808080">(</font>ands <font color="#808080">[</font>c1<font color="#808080">,</font> c2<font color="#808080">]</font><font color="#808080">)</font><font color="#808080">]</font>

true  <font color="#808080">=</font> ands <font color=Green>[]</font>
false <font color="#808080">=</font> inv true

toggle <font color="#808080">=</font> delay <font color="#808080">(</font>inv toggle<font color="#808080">)</font>
<font color=Blue>--toggle = delay (xor true toggle)</font>

<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- DSL b) Implement the type |C|, the primitive operations and |run|</font>
<font color=Blue>-- using a deep embedding.</font>

<u><font color="#804000">data</font></u> <font color=Green>C</font> <u><font color="#804000">where</font></u>
    <font color=Green>Inv</font>    <font color="#808080">::</font> <font color=Green>C</font>    <font color="#808080">-&gt;</font> <font color=Green>C</font>
    <font color=Green>Ands</font>   <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>C</font><font color="#808080">]</font>  <font color="#808080">-&gt;</font> <font color=Green>C</font>
    <font color=Green>Delay</font>  <font color="#808080">::</font> <font color=Green>C</font>    <font color="#808080">-&gt;</font> <font color=Green>C</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Show</font><font color="#808080">)</font>

inv    <font color="#808080">=</font> <font color=Green>Inv</font>
ands   <font color="#808080">=</font> <font color=Green>Ands</font>
delay  <font color="#808080">=</font> <font color=Green>Delay</font>

run <font color="#808080">(</font><font color=Green>Delay</font> c<font color="#808080">)</font>    <font color="#808080">=</font> <font color=Green>False</font> <b><font color="#800080">:</font></b> run c
run <font color="#808080">(</font><font color=Green>Ands</font> cs<font color="#808080">)</font>    <font color="#808080">=</font> map and <font color="#800080">$</font> trans <font color="#800080">$</font> map run cs
run <font color="#808080">(</font><font color=Green>Inv</font> c<font color="#808080">)</font>      <font color="#808080">=</font> map not <font color="#800080">$</font> run c

<u><font color="#804000">type</font></u> <font color=Green>Vec</font>  n a <font color="#808080">=</font> <font color="#808080">[</font>a<font color="#808080">]</font>  <font color=Blue>-- just for documentation</font>
<u><font color="#804000">type</font></u> <font color=Green>Stream</font> a <font color="#808080">=</font> <font color="#808080">[</font>a<font color="#808080">]</font>  <font color=Blue>-- to keep vectors and streams apart</font>

trans <font color="#808080">::</font> <font color=Green>Vec</font> n <font color="#808080">(</font><font color=Green>Stream</font> a<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Stream</font> <font color="#808080">(</font><font color=Green>Vec</font> n a<font color="#808080">)</font>
trans <font color=Green>[]</font>           <font color="#808080">=</font> repeat <font color=Green>[]</font>
trans <font color="#808080">(</font><font color="#808080">(</font>x<b><font color="#800080">:</font></b>xs<font color="#808080">)</font><b><font color="#800080">:</font></b>ss<font color="#808080">)</font>  <font color="#808080">=</font> <font color="#808080">(</font>x <b><font color="#800080">:</font></b> map head ss<font color="#808080">)</font> <b><font color="#800080">:</font></b> trans <font color="#808080">(</font>xs <b><font color="#800080">:</font></b> map tail ss<font color="#808080">)</font>

<font color=Blue>-- Slow version (also OK)</font>
trans' <font color=Green>[]</font>     <font color="#808080">=</font> repeat <font color=Green>[]</font>
trans' <font color="#808080">(</font>s<b><font color="#800080">:</font></b>ss<font color="#808080">)</font> <font color="#808080">=</font> zipWith <font color="#808080">(</font><b><font color="#800080">:</font></b><font color="#808080">)</font> s <font color="#808080">(</font>trans' ss<font color="#808080">)</font>
</pre>
</body>
</html>