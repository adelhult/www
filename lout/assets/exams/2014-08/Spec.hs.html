<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-2014-08/Spec.hs</title>
</head>
<body>
<pre><u><font color="#804000">module</font></u> <font color=Green>Spec</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font>
<u><font color="#804000">import</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>List</font><font color="#808080">(</font><font color="#808080">(</font><font color="#800080">\\</font><font color="#808080">)</font><font color="#808080">,</font> sort<font color="#808080">)</font>
<font color=Blue>-- Spec: use specification based development techniques</font>
<font color=Blue>--     Spec.Test: formulate and test properties about the program</font>
<font color=Blue>--     Spec.Prove: reason about correctness of functional programs</font>
<font color=Blue>--     Spec.Trans: transform programs on the basis of reasoning </font>

<font color=Blue>-- Below is an attempt at a QuickCheck test suite for |qsort :: Ord a =&gt; [a] -&gt; [a]|. </font>

qsort <font color="#808080">::</font> <font color=Green>Ord</font> a <font color="#808080">=&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font>
qsort <font color="#808080">=</font> sort

prop_minimumBad xs         <font color="#808080">=</font> head <font color="#808080">(</font>qsort xs<font color="#808080">)</font> <font color="#800080">==</font> minimum xs

prop_orderedBad xs <font color="#808080">=</font> ordered <font color="#808080">(</font>qsort xs<font color="#808080">)</font>
    <u><font color="#804000">where</font></u>  ordered <font color=Green>[]</font>        <font color="#808080">=</font> <font color=Green>True</font>
           ordered <font color="#808080">(</font>x<b><font color="#800080">:</font></b>y<b><font color="#800080">:</font></b>xs<font color="#808080">)</font>  <font color="#808080">=</font> x <font color="#800080">&lt;=</font> y <font color="#800080">&amp;&amp;</font> ordered <font color="#808080">(</font>y<b><font color="#800080">:</font></b>xs<font color="#808080">)</font>

prop_permutationBad xs <font color="#808080">=</font> permutation xs <font color="#808080">(</font>qsort xs<font color="#808080">)</font>
    <u><font color="#804000">where</font></u> permutation xs ys <font color="#808080">=</font> null <font color="#808080">(</font>xs <font color="#800080">\\</font> ys<font color="#808080">)</font> <font color="#800080">&amp;&amp;</font> null <font color="#808080">(</font>ys <font color="#800080">\\</font> ys<font color="#808080">)</font>


<font color=Blue>-- Find and correct at least one bug per property in the test suite.</font>
<font color=Blue>{-
quickCheck (prop_minimumBad :: [Int] -&gt; Bool)
*** Failed! Exception: 'Prelude.head: empty list' (after 1 test): 
[]
-}</font>

prop_minimum <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Int</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Property</font>
prop_minimum xs <font color="#808080">=</font> not <font color="#808080">(</font>null xs<font color="#808080">)</font> <font color="#800080">==&gt;</font> head <font color="#808080">(</font>qsort xs<font color="#808080">)</font> <font color="#800080">==</font> minimum xs

<font color=Blue>-- Write a |main| function which tests the three properties (for lists of integers) using QuickCheck.</font>

prop_ordered <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Int</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
prop_ordered xs <font color="#808080">=</font> ordered <font color="#808080">(</font>qsort xs<font color="#808080">)</font>
    <u><font color="#804000">where</font></u>  ordered <font color=Green>[]</font>        <font color="#808080">=</font> <font color=Green>True</font>
           ordered <font color="#808080">[</font>x<font color="#808080">]</font>       <font color="#808080">=</font> <font color=Green>True</font>
           ordered <font color="#808080">(</font>x<b><font color="#800080">:</font></b>y<b><font color="#800080">:</font></b>xs<font color="#808080">)</font>  <font color="#808080">=</font> x <font color="#800080">&lt;=</font> y <font color="#800080">&amp;&amp;</font> ordered <font color="#808080">(</font>y<b><font color="#800080">:</font></b>xs<font color="#808080">)</font>

prop_permutation <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Int</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
prop_permutation xs <font color="#808080">=</font> permutation xs <font color="#808080">(</font>qsort xs<font color="#808080">)</font>
    <u><font color="#804000">where</font></u> permutation xs ys <font color="#808080">=</font> null <font color="#808080">(</font>xs <font color="#800080">\\</font> ys<font color="#808080">)</font> <font color="#800080">&amp;&amp;</font> null <font color="#808080">(</font>ys <font color="#800080">\\</font> xs<font color="#808080">)</font>

main <font color="#808080">=</font> <u><font color="#804000">do</font></u> quickCheck prop_minimum
          quickCheck prop_ordered
          quickCheck prop_permutation


<font color=Blue>{-
  Write a sized generator (|sizedList :: Gen a -&gt; Gen [a]|) for random
  lists. Make sure the list length is random (but bounded by the
  current size).
-}</font>

sizedList <font color="#808080">::</font> <font color=Green>Gen</font> a <font color="#808080">-&gt;</font> <font color=Green>Gen</font> <font color="#808080">[</font>a<font color="#808080">]</font>
sizedList g <font color="#808080">=</font> sized <font color="#800080">$</font> <font color="#808080">\</font>n <font color="#808080">-&gt;</font>
              <u><font color="#804000">do</font></u> size <font color="#808080">&lt;-</font> choose <font color="#808080">(</font><font color=Magenta>0</font><font color="#808080">,</font> n<font color="#808080">)</font>
                 myVector size g

myVector <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>Gen</font> a <font color="#808080">-&gt;</font> <font color=Green>Gen</font> <font color="#808080">[</font>a<font color="#808080">]</font>
myVector n g <font color="#808080">=</font> sequence <font color="#808080">(</font>replicate n g<font color="#808080">)</font>


<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- End of exam question</font>

<font color=Blue>-- --------------------------------------------------------------</font>
testBad <font color="#808080">=</font> <u><font color="#804000">do</font></u> quickCheck <font color="#808080">(</font>prop_minimumBad  <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Int</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font><font color="#808080">)</font>
             quickCheck <font color="#808080">(</font>prop_orderedBad  <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Int</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font><font color="#808080">)</font>
             quickCheck <font color="#808080">(</font>prop_permutationBad <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Int</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font><font color="#808080">)</font>


<font color=Blue>----------------</font>
<font color=Blue>-- Sanity check</font>

sizedList' <font color="#808080">::</font> <font color=Green>Gen</font> a <font color="#808080">-&gt;</font> <font color=Green>Gen</font> <font color="#808080">(</font><font color=Green>Int</font><font color="#808080">,</font> <font color="#808080">[</font>a<font color="#808080">]</font><font color="#808080">)</font>
sizedList' g <font color="#808080">=</font> sized <font color="#800080">$</font> <font color="#808080">\</font>n <font color="#808080">-&gt;</font>
              <u><font color="#804000">do</font></u> size <font color="#808080">&lt;-</font> choose <font color="#808080">(</font><font color=Magenta>0</font><font color="#808080">,</font> n<font color="#808080">)</font>
                 fmap <font color="#808080">(</font><font color=Green>(,)</font> n<font color="#808080">)</font> <font color="#800080">$</font> myVector size g
</pre>
</body>
</html>