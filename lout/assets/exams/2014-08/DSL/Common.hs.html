<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-2014-08/DSL/Common.hs</title>
</head>
<body>
<pre><u><font color="#804000">module</font></u> <font color=Green>DSL</font><font color="#800080">.</font><font color=Green>Common</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">data</font></u> <font color=Green>Dir</font>  <font color="#808080">=</font> <font color=Green>Hori</font> <font color="#808080">|</font> <font color=Green>Vert</font> <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Eq</font><font color="#808080">,</font> <font color=Green>Show</font><font color="#808080">)</font>
<u><font color="#804000">type</font></u> <font color=Green>ArtStrs</font> <font color="#808080">=</font> <font color="#808080">[</font><font color=Green>String</font><font color="#808080">]</font>
<u><font color="#804000">type</font></u> <font color=Green>ArtSize</font> <font color="#808080">=</font> <font color="#808080">(</font><font color=Green>Int</font><font color="#808080">,</font> <font color=Green>Int</font><font color="#808080">)</font>
<u><font color="#804000">type</font></u> <font color=Green>Sem</font> <font color="#808080">=</font> <font color="#808080">(</font><font color=Green>ArtSize</font><font color="#808080">,</font> <font color=Green>ArtStrs</font><font color="#808080">)</font>

frameSem <font color="#808080">::</font> <font color=Green>Sem</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font>
frameSem <font color="#808080">(</font><font color="#808080">(</font>rows<font color="#808080">,</font> cols<font color="#808080">)</font><font color="#808080">,</font> ss<font color="#808080">)</font> <font color="#808080">=</font> <font color="#808080">(</font><font color="#808080">(</font>rows <font color="#800080">+</font> <font color=Magenta>2</font><font color="#808080">,</font> cols <font color="#800080">+</font> <font color=Magenta>2</font><font color="#808080">)</font><font color="#808080">,</font> topbot <b><font color="#800080">:</font></b> map f ss <font color="#800080">++</font> <font color="#808080">[</font>topbot<font color="#808080">]</font><font color="#808080">)</font>
  <u><font color="#804000">where</font></u> topbot <font color="#808080">=</font> <font color=Magenta>'+'</font> <b><font color="#800080">:</font></b> replicate cols <font color=Magenta>'-'</font> <font color="#800080">++</font> <font color=Magenta>"+"</font>
        f s <font color="#808080">=</font> <font color=Magenta>'|'</font><b><font color="#800080">:</font></b>s<font color="#800080">++</font><font color=Magenta>"|"</font>

textSem <font color="#808080">::</font> <font color=Green>Dir</font> <font color="#808080">-&gt;</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font>
textSem <font color=Green>Hori</font> s <font color="#808080">=</font> embed <font color="#808080">[</font>s<font color="#808080">]</font>
textSem <font color=Green>Vert</font> s <font color="#808080">=</font> embed <font color="#808080">(</font>map <font color="#808080">(</font><b><font color="#800080">:</font></b><font color=Green>[]</font><font color="#808080">)</font> s<font color="#808080">)</font>

<font color=Blue>-- Invariant: all string in ss must have the same length (or perhaps the first is longest)</font>
embed <font color="#808080">::</font> <font color=Green>ArtStrs</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font>
embed ss <font color="#808080">=</font> <font color="#808080">(</font><font color="#808080">(</font>rows<font color="#808080">,</font> cols<font color="#808080">)</font><font color="#808080">,</font> ss<font color="#808080">)</font>
  <u><font color="#804000">where</font></u> rows <font color="#808080">=</font> length ss
        cols <font color="#808080">|</font> rows <font color="#800080">==</font> <font color=Magenta>0</font> <font color="#808080">=</font> <font color=Magenta>0</font>
             <font color="#808080">|</font> otherwise <font color="#808080">=</font> length <font color="#808080">(</font>head ss<font color="#808080">)</font>

aboveSem  <font color="#808080">::</font> <font color=Green>Sem</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font>
aboveSem <font color="#808080">(</font><font color="#808080">(</font>arows<font color="#808080">,</font> acols<font color="#808080">)</font><font color="#808080">,</font> a<font color="#808080">)</font> <font color="#808080">(</font><font color="#808080">(</font>brows<font color="#808080">,</font> bcols<font color="#808080">)</font><font color="#808080">,</font> b<font color="#808080">)</font> <font color="#808080">=</font> <font color="#808080">(</font><font color="#808080">(</font>arows<font color="#800080">+</font>brows<font color="#808080">,</font> maxcols<font color="#808080">)</font><font color="#808080">,</font> extend maxcols <font color="#808080">(</font>a <font color="#800080">++</font> b<font color="#808080">)</font><font color="#808080">)</font>
  <u><font color="#804000">where</font></u> maxcols <font color="#808080">=</font> max acols bcols

extend <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>ArtStrs</font> <font color="#808080">-&gt;</font> <font color=Green>ArtStrs</font>
extend n <font color="#808080">=</font> map <font color="#808080">(</font>extOne n<font color="#808080">)</font>

extOne <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>String</font>
extOne n xs <font color="#808080">=</font> take n <font color="#808080">(</font>xs <font color="#800080">++</font> repeat <font color=Magenta>' '</font><font color="#808080">)</font>

besideSem <font color="#808080">::</font> <font color=Green>Sem</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font>
besideSem <font color="#808080">(</font><font color="#808080">(</font>arows<font color="#808080">,</font> acols<font color="#808080">)</font><font color="#808080">,</font> a<font color="#808080">)</font> <font color="#808080">(</font><font color="#808080">(</font>brows<font color="#808080">,</font> bcols<font color="#808080">)</font><font color="#808080">,</font> b<font color="#808080">)</font> <font color="#808080">=</font> 
    <font color="#808080">(</font><font color="#808080">(</font>maxrows<font color="#808080">,</font> acols <font color="#800080">+</font> bcols<font color="#808080">)</font><font color="#808080">,</font> zipWith <font color="#808080">(</font><font color="#800080">++</font><font color="#808080">)</font> <font color="#808080">(</font>fillIn <font color="#808080">(</font>maxrows<font color="#808080">,</font> acols<font color="#808080">)</font> a<font color="#808080">)</font> 
                                            <font color="#808080">(</font>fillIn <font color="#808080">(</font>maxrows<font color="#808080">,</font> bcols<font color="#808080">)</font> b<font color="#808080">)</font><font color="#808080">)</font>
  <u><font color="#804000">where</font></u> maxrows <font color="#808080">=</font> max arows brows

<font color=Blue>-- make sure all lines lengths match and column lenghts match</font>
fillIn <font color="#808080">::</font> <font color=Green>ArtSize</font> <font color="#808080">-&gt;</font> <font color=Green>ArtStrs</font> <font color="#808080">-&gt;</font> <font color=Green>ArtStrs</font>
fillIn <font color="#808080">(</font>rows<font color="#808080">,</font> cols<font color="#808080">)</font> ss <font color="#808080">=</font> extend cols rowsDone
  <u><font color="#804000">where</font></u>  rowsDone <font color="#808080">::</font> <font color=Green>ArtStrs</font>
         rowsDone <font color="#808080">=</font> take rows <font color="#808080">(</font>ss <font color="#800080">++</font> repeat <font color=Green>[]</font><font color="#808080">)</font>

spaceSem <font color="#808080">::</font> <font color=Green>ArtSize</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font>
spaceSem shape <font color="#808080">=</font> <font color="#808080">(</font>shape<font color="#808080">,</font> fillIn shape <font color=Green>[]</font><font color="#808080">)</font>

<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Not asked for in the exam:</font>

lineSem   <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>Dir</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font>
lineSem n <font color=Green>Hori</font> <font color="#808080">=</font> embed <font color="#808080">[</font>replicate n <font color=Magenta>'-'</font><font color="#808080">]</font>
lineSem n <font color=Green>Vert</font> <font color="#808080">=</font> embed <font color="#808080">(</font>replicate n <font color=Magenta>"|"</font><font color="#808080">)</font>

emptySem  <font color="#808080">::</font> <font color=Green>Sem</font>
emptySem <font color="#808080">=</font> <font color="#808080">(</font><font color="#808080">(</font><font color=Magenta>0</font><font color="#808080">,</font> <font color=Magenta>0</font><font color="#808080">)</font><font color="#808080">,</font> <font color=Green>[]</font><font color="#808080">)</font>
</pre>
</body>
</html>