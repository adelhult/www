<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-20120828/Types.hs</title>
</head>
<body>
<pre><u><font color="#804000">module</font></u> <font color=Green>Types</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#808080">(</font>mapM<font color="#808080">,</font> liftM<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font>

<u><font color="#804000">newtype</font></u> <font color=Green>ListT</font> m a <font color="#808080">=</font> <font color=Green>ListT</font> <font color="#808080">{</font> runListT <font color="#808080">::</font> m <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">}</font>
<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>Monad</font> <font color="#808080">(</font><font color=Green>ListT</font> m<font color="#808080">)</font> <u><font color="#804000">where</font></u>
    return  <font color="#808080">=</font>  returnLT
    <font color="#808080">(</font><font color="#800080">&gt;&gt;=</font><font color="#808080">)</font>   <font color="#808080">=</font>  bindLT

returnLT <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font> <font color=Green>ListT</font> m a
returnLT a <font color="#808080">=</font> <font color=Green>ListT</font> mLa
  <u><font color="#804000">where</font></u> <font color=Blue>-- mLa :: m [a]</font>
        mLa <font color="#808080">=</font> return <font color="#808080">[</font>a<font color="#808080">]</font>
<font color=Blue>-- alt. the "bigmouth smiley" version</font>
returnLT' <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font> <font color=Green>ListT</font> m a
returnLT'  <font color="#808080">=</font> <font color=Green>ListT</font> <font color="#800080">.</font> return <font color="#800080">.</font> <font color="#808080">(</font><b><font color="#800080">:</font></b><font color=Green>[]</font><font color="#808080">)</font>
<font color=Blue>-- alt. the "monad zen" version</font>
returnLT'' <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font> <font color=Green>ListT</font> m a
returnLT'' <font color="#808080">=</font> <font color=Green>ListT</font> <font color="#800080">.</font> return <font color="#800080">.</font> return

bindLT <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> <font color=Green>ListT</font> m a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color=Green>ListT</font> m b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>ListT</font> m b
bindLT ltm f <font color="#808080">=</font> <font color=Green>ListT</font> mLb
  <u><font color="#804000">where</font></u> mLb <font color="#808080">=</font> <u><font color="#804000">do</font></u>  <u><font color="#804000">as</font></u> <font color="#808080">&lt;-</font> runListT ltm
                  bss <font color="#808080">&lt;-</font> mapM <font color="#808080">(</font>runListT <font color="#800080">.</font> f<font color="#808080">)</font> <u><font color="#804000">as</font></u>
                  return <font color="#808080">(</font>concat bss<font color="#808080">)</font>

<font color=Blue>----------------------------------------------------------------</font>
<u><font color="#804000">type</font></u> <font color=Green>Equal</font> a <font color="#808080">=</font> <font color="#808080">[</font>a<font color="#808080">]</font>
<font color="#808080">(</font><font color="#800080">===</font><font color="#808080">)</font> <font color="#808080">::</font> a <font color="#808080">-&gt;</font> a <font color="#808080">-&gt;</font> <font color=Green>Equal</font> a
a <font color="#800080">===</font> b <font color="#808080">=</font> <font color="#808080">[</font>a<font color="#808080">,</font> b<font color="#808080">]</font>
commutative <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> m a <font color="#808080">-&gt;</font> m b <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> b <font color="#808080">-&gt;</font> m c<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Equal</font> <font color="#808080">(</font>m c<font color="#808080">)</font>
commutative m1 m2 f <font color="#808080">=</font> lhs <font color="#800080">===</font> rhs
  <u><font color="#804000">where</font></u>  lhs <font color="#808080">=</font>  <u><font color="#804000">do</font></u>  a1 <font color="#808080">&lt;-</font> m1
                    a2 <font color="#808080">&lt;-</font> m2
                    f a1 a2 
         rhs <font color="#808080">=</font>  <u><font color="#804000">do</font></u>  a2 <font color="#808080">&lt;-</font> m2
                    a1 <font color="#808080">&lt;-</font> m1
                    f a1 a2 
    
<font color=Blue>-- Intermediate stage (not needed):</font>
spec_comm_Either <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Eq</font> e<font color="#808080">,</font> <font color=Green>Eq</font> c<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color="#808080">(</font><font color=Green>Either</font> e a<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>Either</font> e b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> b <font color="#808080">-&gt;</font> <font color=Green>Either</font> e c<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Equal</font> <font color="#808080">(</font><font color=Green>Either</font> e c<font color="#808080">)</font>
spec_comm_Either <font color="#808080">=</font> commutative

<font color=Blue>-- Monomorphic types</font>
<u><font color="#804000">type</font></u> <font color=Green>E</font> <font color="#808080">=</font> <font color=Green>String</font>
<u><font color="#804000">type</font></u> <font color=Green>A</font> <font color="#808080">=</font> <font color=Green>Int</font>
<u><font color="#804000">type</font></u> <font color=Green>B</font> <font color="#808080">=</font> <font color=Green>Bool</font>
<u><font color="#804000">type</font></u> <font color=Green>C</font> <font color="#808080">=</font> <font color=Green>Char</font>
spec_comm_Either_mono <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Either</font> <font color=Green>E</font> <font color=Green>A</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>Either</font> <font color=Green>E</font> <font color=Green>B</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>A</font> <font color="#808080">-&gt;</font> <font color=Green>B</font> <font color="#808080">-&gt;</font> <font color=Green>Either</font> <font color=Green>E</font> <font color=Green>C</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Equal</font> <font color="#808080">(</font><font color=Green>Either</font> <font color=Green>E</font> <font color=Green>C</font><font color="#808080">)</font>
spec_comm_Either_mono <font color="#808080">=</font> spec_comm_Either

<font color=Blue>-- the Blind modifier is not required on the exam</font>
test_E <font color="#808080">=</font> quickCheck <font color="#808080">(</font><font color="#808080">\</font>ma mb <font color="#808080">(</font><font color=Green>Blind</font> f<font color="#808080">)</font> <font color="#808080">-&gt;</font> allEq <font color="#800080">$</font> spec_comm_Either_mono ma mb f<font color="#808080">)</font>

<font color=Blue>-- Only one of these three answers is needed for the exam:</font>
<font color=Blue>-- (Either e) is not a commutative monad because bind returns the _first_ error only.</font>
<font color=Blue>-- ((,) e) is commutative iff the Monoid e is commutative (so, not for</font>
<font color=Blue>--   the typical case of the Writer with e = [a])</font>
<font color=Blue>-- ((-&gt;) e) is commutative: the environment is unchanged along the computation (see below for proof - not needed on the exam)</font>

<font color=Blue>{-
instance (Arbitrary e, Arbitrary a) =&gt; Arbitrary (Either e a) where
  arbitrary = do n &lt;- choose (0,10)
                 if n == 0 
                   then  liftM Left   arbitrary
                   else  liftM Right  arbitrary
-}</font>
<font color=Blue>----------------------------------------------------------------</font>

<font color=Blue>{-
-- Available in Control.Monad.Instances
instance Monad (Either e) where
  return  =  returnE
  (&gt;&gt;=)   =  bindE
  
returnE :: a -&gt; Either e a  
returnE = Right

bindE :: Either e a -&gt; (a -&gt; Either e b) -&gt; Either e b
bindE (Left e)   f = Left e
bindE (Right a)  f = f a
-}</font>


<font color=Blue>----------------------------------------------------------------</font>

spec_comm_Fun_mono <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>E</font> <font color="#808080">-&gt;</font> <font color=Green>A</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>E</font> <font color="#808080">-&gt;</font> <font color=Green>B</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>A</font> <font color="#808080">-&gt;</font> <font color=Green>B</font> <font color="#808080">-&gt;</font> <font color=Green>E</font> <font color="#808080">-&gt;</font> <font color=Green>C</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Equal</font> <font color="#808080">(</font><font color=Green>E</font> <font color="#808080">-&gt;</font> <font color=Green>C</font><font color="#808080">)</font>
spec_comm_Fun_mono <font color="#808080">=</font> commutative


bindF <font color="#808080">::</font> <font color="#808080">(</font><font color="#808080">(</font><font color="#808080">-&gt;</font><font color="#808080">)</font> e<font color="#808080">)</font> a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color="#808080">(</font><font color="#808080">-&gt;</font><font color="#808080">)</font> e<font color="#808080">)</font> b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color="#808080">(</font><font color="#808080">-&gt;</font><font color="#808080">)</font> e<font color="#808080">)</font> b
<font color=Blue>-- bindF :: (e -&gt; a) -&gt; (a -&gt; (e -&gt; b)) -&gt; (e -&gt; b)</font>
bindF ma f <font color="#808080">=</font> <font color="#808080">\</font>e <font color="#808080">-&gt;</font> f <font color="#808080">(</font>ma e<font color="#808080">)</font> e
  
commute <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> m a <font color="#808080">-&gt;</font> m b <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> b <font color="#808080">-&gt;</font> m c<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Equal</font> <font color="#808080">(</font>m c<font color="#808080">)</font>
commute m1 m2 f <font color="#808080">=</font> 
  <font color="#808080">[</font> <u><font color="#804000">do</font></u> a1 <font color="#808080">&lt;-</font> m1<font color="#808080">;</font> a2 <font color="#808080">&lt;-</font> m2<font color="#808080">;</font> f a1 a2
  <font color="#808080">,</font> <u><font color="#804000">do</font></u> a2 <font color="#808080">&lt;-</font> m2<font color="#808080">;</font> a1 <font color="#808080">&lt;-</font> m1<font color="#808080">;</font> f a1 a2
  <font color="#808080">]</font>

commute_F <font color="#808080">::</font> <font color="#808080">(</font>e<font color="#808080">-&gt;</font>a<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>e<font color="#808080">-&gt;</font>b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> b <font color="#808080">-&gt;</font> <font color="#808080">(</font>e<font color="#808080">-&gt;</font>c<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Equal</font> <font color="#808080">(</font>e<font color="#808080">-&gt;</font>c<font color="#808080">)</font>
commute_F m1 m2 f <font color="#808080">=</font> 
  <font color="#808080">[</font> <u><font color="#804000">do</font></u> a1 <font color="#808080">&lt;-</font> m1<font color="#808080">;</font> a2 <font color="#808080">&lt;-</font> m2<font color="#808080">;</font> f a1 a2                        <font color=Blue>-- do sugar</font>
  <font color="#808080">,</font> m1 <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>a1 <font color="#808080">-&gt;</font> <u><font color="#804000">do</font></u> a2 <font color="#808080">&lt;-</font> m2<font color="#808080">;</font> f a1 a2                    <font color=Blue>-- do sugar</font>
  <font color="#808080">,</font> m1 <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>a1 <font color="#808080">-&gt;</font> m2 <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>a2 <font color="#808080">-&gt;</font> f a1 a2                   <font color=Blue>-- (&gt;&gt;=) is bindF</font>
  <font color="#808080">,</font> bindF m1 <font color="#808080">(</font><font color="#808080">\</font>a1 <font color="#808080">-&gt;</font> bindF m2 <font color="#808080">(</font><font color="#808080">\</font>a2 <font color="#808080">-&gt;</font> f a1 a2<font color="#808080">)</font><font color="#808080">)</font>           <font color=Blue>-- Def. of bindF</font>
  <font color="#808080">,</font> bindF m1 <font color="#808080">(</font><font color="#808080">\</font>a1 <font color="#808080">-&gt;</font> <font color="#808080">\</font>e' <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color="#808080">\</font>a2 <font color="#808080">-&gt;</font> f a1 a2<font color="#808080">)</font> <font color="#808080">(</font>m2 e'<font color="#808080">)</font> e'<font color="#808080">)</font>  <font color=Blue>-- beta-reduction</font>
  <font color="#808080">,</font> bindF m1 <font color="#808080">(</font><font color="#808080">\</font>a1 <font color="#808080">-&gt;</font> <font color="#808080">\</font>e' <font color="#808080">-&gt;</font> f a1 <font color="#808080">(</font>m2 e'<font color="#808080">)</font> e'<font color="#808080">)</font>              <font color=Blue>-- Def. of bindF </font>
  <font color="#808080">,</font> <font color="#808080">\</font>e <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color="#808080">\</font>a1 <font color="#808080">-&gt;</font> <font color="#808080">\</font>e' <font color="#808080">-&gt;</font> f a1 <font color="#808080">(</font>m2 e'<font color="#808080">)</font> e'<font color="#808080">)</font> <font color="#808080">(</font>m1 e<font color="#808080">)</font> e        <font color=Blue>-- beta-red.</font>
  <font color="#808080">,</font> <font color="#808080">\</font>e <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color="#808080">\</font>e' <font color="#808080">-&gt;</font> f <font color="#808080">(</font>m1 e<font color="#808080">)</font> <font color="#808080">(</font>m2 e'<font color="#808080">)</font> e'<font color="#808080">)</font> e                  <font color=Blue>-- beta-red.</font>
  <font color="#808080">,</font> <font color="#808080">\</font>e <font color="#808080">-&gt;</font> f <font color="#808080">(</font>m1 e<font color="#808080">)</font> <font color="#808080">(</font>m2 e<font color="#808080">)</font> e                               <font color=Blue>-- Proof midpoint</font>
  <font color="#808080">,</font> <font color="#808080">\</font>e <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color="#808080">\</font>e' <font color="#808080">-&gt;</font> f <font color="#808080">(</font>m1 e'<font color="#808080">)</font> <font color="#808080">(</font>m2 e<font color="#808080">)</font> e'<font color="#808080">)</font> e                  <font color=Blue>-- ~= same backwards</font>
  <font color="#808080">,</font> <font color="#808080">\</font>e <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color="#808080">\</font>a2 <font color="#808080">-&gt;</font> <font color="#808080">\</font>e' <font color="#808080">-&gt;</font> f <font color="#808080">(</font>m1 e'<font color="#808080">)</font> a2 e'<font color="#808080">)</font> <font color="#808080">(</font>m2 e<font color="#808080">)</font> e
  <font color="#808080">,</font> bindF m2 <font color="#808080">(</font><font color="#808080">\</font>a2 <font color="#808080">-&gt;</font> <font color="#808080">\</font>e' <font color="#808080">-&gt;</font> f <font color="#808080">(</font>m1 e'<font color="#808080">)</font> a2 e'<font color="#808080">)</font>
  <font color="#808080">,</font> bindF m2 <font color="#808080">(</font><font color="#808080">\</font>a2 <font color="#808080">-&gt;</font> <font color="#808080">\</font>e' <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color="#808080">\</font>a1 <font color="#808080">-&gt;</font> f a1 a2<font color="#808080">)</font> <font color="#808080">(</font>m1 e'<font color="#808080">)</font> e'<font color="#808080">)</font>
  <font color="#808080">,</font> bindF m2 <font color="#808080">(</font><font color="#808080">\</font>a2 <font color="#808080">-&gt;</font> bindF m1 <font color="#808080">(</font><font color="#808080">\</font>a1 <font color="#808080">-&gt;</font> f a1 a2<font color="#808080">)</font><font color="#808080">)</font>
  <font color="#808080">,</font> m2 <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>a2 <font color="#808080">-&gt;</font> m1 <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>a1 <font color="#808080">-&gt;</font> f a1 a2
  <font color="#808080">,</font> m2 <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>a2 <font color="#808080">-&gt;</font> <u><font color="#804000">do</font></u> a1 <font color="#808080">&lt;-</font> m1<font color="#808080">;</font> f a1 a2
  <font color="#808080">,</font> <u><font color="#804000">do</font></u> a2 <font color="#808080">&lt;-</font> m2<font color="#808080">;</font> a1 <font color="#808080">&lt;-</font> m1<font color="#808080">;</font> f a1 a2
  <font color="#808080">]</font>
  
allEq <font color="#808080">::</font> <font color=Green>Eq</font> a <font color="#808080">=&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
allEq <font color=Green>[]</font> <font color="#808080">=</font> <font color=Green>True</font>
allEq <font color="#808080">(</font>x<b><font color="#800080">:</font></b>xs<font color="#808080">)</font> <font color="#808080">=</font> all <font color="#808080">(</font>x<font color="#800080">==</font><font color="#808080">)</font> xs

<font color=Blue>-- the Blind modifier is not required on the exam</font>
test3 <font color="#808080">=</font> quickCheck <font color="#808080">(</font><font color="#808080">\</font><font color="#808080">(</font><font color=Green>Blind</font> ma<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Blind</font> mb<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Blind</font> f<font color="#808080">)</font> e <font color="#808080">-&gt;</font> 
                     allEq <font color="#800080">$</font> map <font color="#808080">(</font><font color="#800080">$</font>e<font color="#808080">)</font> <font color="#800080">$</font> 
                     commute_F <font color="#808080">(</font>ma <font color="#808080">::</font> <font color=Green>E</font><font color="#808080">-&gt;</font><font color=Green>A</font><font color="#808080">)</font> <font color="#808080">(</font>mb <font color="#808080">::</font> <font color=Green>E</font><font color="#808080">-&gt;</font><font color=Green>B</font><font color="#808080">)</font> 
                               <font color="#808080">(</font>f <font color="#808080">::</font> <font color=Green>A</font> <font color="#808080">-&gt;</font> <font color=Green>B</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>E</font><font color="#808080">-&gt;</font><font color=Green>C</font><font color="#808080">)</font><font color="#808080">)</font><font color="#808080">)</font>

</pre>
</body>
</html>