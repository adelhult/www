<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-20120307/Spec.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE GADTs #-}</font>
<font color=Blue>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FlexibleContexts #-}</font>
<font color=Blue>{-# LANGUAGE GeneralizedNewtypeDeriving #-}</font>

<u><font color="#804000">module</font></u> <font color=Green>Spec</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font> <u><font color="#804000">as</font></u> <font color=Green>CMS</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font> <font color="#808080">(</font><font color=Green>MonadState</font><font color="#808080">,</font> get<font color="#808080">,</font> put<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Applicative</font> <font color=Blue>-- not required for the exam</font>
<u><font color="#804000">import</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font> <font color=Blue>-- not needed for the exam question</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font><font color="#800080">.</font><font color=Green>Property</font> <u><font color="#804000">as</font></u> <font color=Green>QC</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font><font color="#800080">.</font><font color=Green>Arbitrary</font> <u><font color="#804000">as</font></u> <font color=Green>QC</font>

<font color=Blue>------</font>
<font color=Blue>-- Exam question, supporting code</font>
<font color=Blue>-- The four MonadState laws (specialised to (S2 s a) to avoid ambiguous types):</font>
putput <font color="#808080">::</font> <font color=Green>Eq</font> s <font color="#808080">=&gt;</font> s <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
putput s' s <font color="#808080">=</font> 
  <font color="#808080">(</font>put s' <font color="#800080">&gt;&gt;</font> put s<font color="#808080">)</font>                      <font color="#800080">=.=</font>  put s

putget <font color="#808080">::</font> <font color=Green>Eq</font> s <font color="#808080">=&gt;</font> s <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
putget s <font color="#808080">=</font> 
  <font color="#808080">(</font>put s <font color="#800080">&gt;&gt;</font> get<font color="#808080">)</font>                         <font color="#800080">=.=</font>  <font color="#808080">(</font>put s <font color="#800080">&gt;&gt;</font> return s<font color="#808080">)</font>

getput <font color="#808080">::</font> <font color=Green>Eq</font> s <font color="#808080">=&gt;</font> <font color=Green>S2</font> s <font color=Green>()</font> <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
getput phony <font color="#808080">=</font> <font color=Blue>-- the first argument is only to disambiguate the types</font>
  <font color="#808080">(</font>get <font color="#800080">&gt;&gt;=</font> put<font color="#808080">)</font>                          <font color="#800080">=.=</font>  <font color="#808080">(</font>skip <font color="#800080">`asTypeOf`</font> phony<font color="#808080">)</font>

getget <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Eq</font> a<font color="#808080">,</font> <font color=Green>Eq</font> s<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color="#808080">(</font>s <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> <font color=Green>S2</font> s a<font color="#808080">)</font> <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
getget k <font color="#808080">=</font> 
  <font color="#808080">(</font>get <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>s <font color="#808080">-&gt;</font> get <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>s' <font color="#808080">-&gt;</font> k s s'<font color="#808080">)</font>  <font color="#800080">=.=</font>  <font color="#808080">(</font>get <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>s <font color="#808080">-&gt;</font> k s s<font color="#808080">)</font>

skip <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> m <font color=Green>()</font>
skip <font color="#808080">=</font> return <font color=Green>()</font>

<font color=Blue>-- Consider the following instance:</font>
<u><font color="#804000">data</font></u> <font color=Green>S2</font> s a <u><font color="#804000">where</font></u>
  <font color=Green>Return</font>  <font color="#808080">::</font>  a <font color="#808080">-&gt;</font> <font color=Green>S2</font> s a
  <font color=Green>Bind</font>    <font color="#808080">::</font>  <font color=Green>S2</font> s a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color=Green>S2</font> s b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>S2</font> s b
  <font color=Green>Then</font>    <font color="#808080">::</font>  <font color=Green>S2</font> s a <font color="#808080">-&gt;</font> <font color=Green>S2</font> s b <font color="#808080">-&gt;</font> <font color=Green>S2</font> s b
  <font color=Green>Get</font>     <font color="#808080">::</font>  <font color=Green>S2</font> s s
  <font color=Green>Put</font>     <font color="#808080">::</font>  s <font color="#808080">-&gt;</font> <font color=Green>S2</font> s <font color=Green>()</font>

<u><font color="#804000">instance</font></u> <font color=Green>Monad</font> <font color="#808080">(</font><font color=Green>S2</font> s<font color="#808080">)</font> <u><font color="#804000">where</font></u> <font color="#808080">{</font>return <font color="#808080">=</font> <font color=Green>Return</font><font color="#808080">;</font> <font color="#808080">(</font><font color="#800080">&gt;&gt;=</font><font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>Bind</font><font color="#808080">;</font> <font color="#808080">(</font><font color="#800080">&gt;&gt;</font><font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>Then</font><font color="#808080">}</font>
<u><font color="#804000">instance</font></u> <font color=Green>MonadState</font> s <font color="#808080">(</font><font color=Green>S2</font> s<font color="#808080">)</font> <u><font color="#804000">where</font></u> <font color="#808080">{</font>get <font color="#808080">=</font> <font color=Green>Get</font><font color="#808080">;</font> put <font color="#808080">=</font> <font color=Green>Put</font><font color="#808080">}</font>

<font color=Blue>{- Task a:  
  Implement a run function |runS2 :: S2 s a -&gt; (s -&gt; (a, s))| and
  prove (by equational reasoning) that the put-put and put-get laws
  hold if |(==)| means ``all runs are equal''.
-}</font>

<font color=Blue>-- Run function (part of the answer to Task a):</font>

runS2 <font color="#808080">::</font> <font color=Green>S2</font> s a   <font color="#808080">-&gt;</font> <font color="#808080">(</font>s <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">,</font> s<font color="#808080">)</font><font color="#808080">)</font>
runS2 <font color="#808080">(</font><font color=Green>Return</font> a<font color="#808080">)</font>  <font color="#808080">=</font>  <font color="#808080">\</font>s <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">,</font> s<font color="#808080">)</font>
runS2 <font color="#808080">(</font><font color=Green>Bind</font> m f<font color="#808080">)</font>  <font color="#808080">=</font>  <font color="#808080">\</font>s <font color="#808080">-&gt;</font> <u><font color="#804000">let</font></u> <font color="#808080">(</font>a<font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">=</font> runS2 m s  <u><font color="#804000">in</font></u> runS2 <font color="#808080">(</font>f a<font color="#808080">)</font> s'
runS2 <font color="#808080">(</font><font color=Green>Then</font> m m'<font color="#808080">)</font> <font color="#808080">=</font>  <font color="#808080">\</font>s <font color="#808080">-&gt;</font> <u><font color="#804000">let</font></u> <font color="#808080">(</font><u><font color="#804000">_</font></u><font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">=</font> runS2 m s  <u><font color="#804000">in</font></u> runS2 m' s'
runS2 <font color=Green>Get</font>         <font color="#808080">=</font>  <font color="#808080">\</font>s <font color="#808080">-&gt;</font> <font color="#808080">(</font>s<font color="#808080">,</font>  s<font color="#808080">)</font>
runS2 <font color="#808080">(</font><font color=Green>Put</font> s<font color="#808080">)</font>     <font color="#808080">=</font>  <font color="#808080">\</font><u><font color="#804000">_</font></u> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font> s<font color="#808080">)</font>

<font color=Blue>{- For the proof part of Task a we apply runS2 to the lhs and rhs in
the same starting state and show equality by equational reasoning.
For testing and type-checking purposes I write the steps of the proof
in a Haskell list - this is not required in the exam.  -}</font>

<font color=Blue>-- Proof of putput s' s =  (put s' &gt;&gt; put s) =.=  put s</font>
putput_proof <font color="#808080">::</font> s <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> <font color=Green>AllEq</font> <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font> s<font color="#808080">)</font>
putput_proof s1 s2 s3 <font color="#808080">=</font> <font color=Green>AllEq</font>  
  <font color="#808080">[</font> runS2 <font color="#808080">(</font>put s1 <font color="#800080">&gt;&gt;</font> put s2<font color="#808080">)</font> s3
  <font color="#808080">,</font>  <font color=Blue>-- def. of put, (&gt;&gt;)</font>
    runS2 <font color="#808080">(</font><font color=Green>Then</font> <font color="#808080">(</font><font color=Green>Put</font> s1<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Put</font> s2<font color="#808080">)</font><font color="#808080">)</font> s3
  <font color="#808080">,</font>  <font color=Blue>-- def. of runS2 for Then</font>
    <font color="#808080">(</font><font color="#808080">\</font>s <font color="#808080">-&gt;</font> <u><font color="#804000">let</font></u> <font color="#808080">(</font><u><font color="#804000">_</font></u><font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">=</font> runS2 <font color="#808080">(</font><font color=Green>Put</font> s1<font color="#808080">)</font> s  <u><font color="#804000">in</font></u> runS2 <font color="#808080">(</font><font color=Green>Put</font> s2<font color="#808080">)</font> s'<font color="#808080">)</font> s3
  <font color="#808080">,</font>  <font color=Blue>-- def. of runS2 for Put (twice)</font>
    <font color="#808080">(</font><font color="#808080">\</font>s <font color="#808080">-&gt;</font> <u><font color="#804000">let</font></u> <font color="#808080">(</font><u><font color="#804000">_</font></u><font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">=</font> <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font>s1<font color="#808080">)</font> <u><font color="#804000">in</font></u> <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font>s2<font color="#808080">)</font><font color="#808080">)</font> s3
  <font color="#808080">,</font>  <font color=Blue>-- beta-red. &amp; simplify unreachable binding</font>
    <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font> s2<font color="#808080">)</font>
  <font color="#808080">,</font>  <font color=Blue>-- beta-red. (from here all steps are "backwards")</font>
    <font color="#808080">(</font><font color="#808080">\</font><u><font color="#804000">_</font></u> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font> s2<font color="#808080">)</font><font color="#808080">)</font> s3
  <font color="#808080">,</font>  <font color=Blue>-- def. of runS2 for Put</font>
    runS2 <font color="#808080">(</font><font color=Green>Put</font> s2<font color="#808080">)</font> s3
  <font color="#808080">,</font>  <font color=Blue>-- def. of put</font>
    runS2 <font color="#808080">(</font>put s2<font color="#808080">)</font> s3
  <font color="#808080">]</font>

<font color=Blue>-- Proof of put-get:  (put s &gt;&gt; get) ==  (put s &gt;&gt; return s)</font>
putget_proof <font color="#808080">::</font> <font color=Green>Eq</font> s <font color="#808080">=&gt;</font> s <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> <font color=Green>AllEq</font> <font color="#808080">(</font>s<font color="#808080">,</font> s<font color="#808080">)</font>
putget_proof s1 s2 <font color="#808080">=</font> <font color=Green>AllEq</font>
  <font color="#808080">[</font> runS2 <font color="#808080">(</font>put s1 <font color="#800080">&gt;&gt;</font> get<font color="#808080">)</font> s2
  <font color="#808080">,</font> <font color=Blue>-- def. of put, get, (&gt;&gt;)</font>
    runS2 <font color="#808080">(</font><font color=Green>Then</font> <font color="#808080">(</font><font color=Green>Put</font> s1<font color="#808080">)</font> <font color=Green>Get</font><font color="#808080">)</font> s2
  <font color="#808080">,</font> <font color=Blue>-- def. of runS2 for Then</font>
    <font color="#808080">(</font><font color="#808080">\</font>s <font color="#808080">-&gt;</font> <u><font color="#804000">let</font></u> <font color="#808080">(</font><u><font color="#804000">_</font></u><font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">=</font> runS2 <font color="#808080">(</font><font color=Green>Put</font> s1<font color="#808080">)</font> s  <u><font color="#804000">in</font></u> runS2 <font color=Green>Get</font> s'<font color="#808080">)</font> s2
  <font color="#808080">,</font> <font color=Blue>-- def. of runS2 for Put and beta-red.</font>
    <u><font color="#804000">let</font></u> <font color="#808080">(</font><u><font color="#804000">_</font></u><font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">=</font> <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font> s1<font color="#808080">)</font>  <u><font color="#804000">in</font></u> runS2 <font color=Green>Get</font> s'
  <font color="#808080">,</font> <font color=Blue>-- inline</font>
    runS2 <font color=Green>Get</font> s1
  <font color="#808080">,</font> <font color=Blue>-- def. of runS2 for Get and beta-red.</font>
    <font color="#808080">(</font>s1<font color="#808080">,</font> s1<font color="#808080">)</font>
  <font color="#808080">,</font> <font color=Blue>-- def. of runS2 for Return and beta-red.</font>
    runS2 <font color="#808080">(</font><font color=Green>Return</font> s1<font color="#808080">)</font> s1
  <font color="#808080">,</font> <font color=Blue>-- inline</font>
    <u><font color="#804000">let</font></u> <font color="#808080">(</font><u><font color="#804000">_</font></u><font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">=</font> <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font> s1<font color="#808080">)</font>  <u><font color="#804000">in</font></u> runS2 <font color="#808080">(</font><font color=Green>Return</font> s1<font color="#808080">)</font> s'
  <font color="#808080">,</font> <font color=Blue>-- def. of runS2 for Put and beta-red.</font>
    <font color="#808080">(</font><font color="#808080">\</font>s <font color="#808080">-&gt;</font> <u><font color="#804000">let</font></u> <font color="#808080">(</font><u><font color="#804000">_</font></u><font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">=</font> runS2 <font color="#808080">(</font><font color=Green>Put</font> s1<font color="#808080">)</font> s  <u><font color="#804000">in</font></u> runS2 <font color="#808080">(</font><font color=Green>Return</font> s1<font color="#808080">)</font> s'<font color="#808080">)</font> s2
  <font color="#808080">,</font> <font color=Blue>-- def. of runS2 for Then</font>
    runS2 <font color="#808080">(</font><font color=Green>Then</font> <font color="#808080">(</font><font color=Green>Put</font> s1<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Return</font> s1<font color="#808080">)</font><font color="#808080">)</font> s2
  <font color="#808080">,</font> <font color=Blue>-- def. put, return, (&gt;&gt;)</font>
    runS2 <font color="#808080">(</font>put s1 <font color="#800080">&gt;&gt;</font> return s1<font color="#808080">)</font> s2
  <font color="#808080">]</font>

<font color=Blue>-- Task (b): Program transformation based on reasoning</font>

<u><font color="#804000">data</font></u> <font color=Green>S3</font> s a <u><font color="#804000">where</font></u>
  <font color=Green>Ret3</font>     <font color="#808080">::</font>  a <font color="#808080">-&gt;</font> <font color=Green>S3</font> s a
  <font color=Green>GetBind</font>  <font color="#808080">::</font>  <font color="#808080">(</font>s <font color="#808080">-&gt;</font> <font color=Green>S3</font> s a<font color="#808080">)</font>  <font color="#808080">-&gt;</font>  <font color=Green>S3</font> s a
  <font color=Green>PutThen</font>  <font color="#808080">::</font>  s <font color="#808080">-&gt;</font> <font color=Green>S3</font> s a    <font color="#808080">-&gt;</font>  <font color=Green>S3</font> s a

opt <font color="#808080">::</font> <font color=Green>S2</font> s a <font color="#808080">-&gt;</font> <font color=Green>S3</font> s a
opt <font color="#808080">(</font><font color=Green>Return</font> a<font color="#808080">)</font>    <font color="#808080">=</font>  <font color=Green>Ret3</font> a
opt <font color=Green>Get</font>           <font color="#808080">=</font>  get3
opt <font color="#808080">(</font><font color=Green>Put</font> s<font color="#808080">)</font>       <font color="#808080">=</font>  put3 s
opt <font color="#808080">(</font><font color=Green>Bind</font> m f<font color="#808080">)</font>    <font color="#808080">=</font>  removeBind m f
opt <font color="#808080">(</font><font color=Green>Then</font> m n<font color="#808080">)</font>    <font color="#808080">=</font>  removeThen m n

put3 <font color="#808080">::</font> s <font color="#808080">-&gt;</font> <font color=Green>S3</font> s <font color=Green>()</font>
put3 s <font color="#808080">=</font> <font color=Green>PutThen</font> s <font color="#808080">(</font><font color=Green>Ret3</font> <font color=Green>()</font><font color="#808080">)</font>

get3 <font color="#808080">::</font> <font color=Green>S3</font> s s
get3 <font color="#808080">=</font> <font color=Green>GetBind</font> <font color=Green>Ret3</font>  

<font color=Blue>-- Task: Implement |removeBind| and |removeThen| and motivate your definitions.</font>
removeBind <font color="#808080">::</font> <font color=Green>S2</font> s a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color=Green>S2</font> s b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>S3</font> s b
removeBind <font color="#808080">(</font><font color=Green>Return</font> a<font color="#808080">)</font>  f  <font color="#808080">=</font>  opt <font color="#808080">(</font>f a<font color="#808080">)</font>                        <font color=Blue>-- Monad law 1</font>
removeBind <font color=Green>Get</font>         f  <font color="#808080">=</font>  <font color=Green>GetBind</font> <font color="#808080">(</font>opt <font color="#800080">.</font> f<font color="#808080">)</font>                <font color=Blue>-- new constructor</font>
removeBind <font color="#808080">(</font><font color=Green>Put</font> s<font color="#808080">)</font>     f  <font color="#808080">=</font>  <font color=Green>PutThen</font> s <font color="#808080">(</font>opt <font color="#808080">(</font>f <font color=Green>()</font><font color="#808080">)</font><font color="#808080">)</font>           <font color=Blue>-- new constructor</font>
removeBind <font color="#808080">(</font><font color=Green>Then</font> m n<font color="#808080">)</font>  f  <font color="#808080">=</font>  opt <font color="#808080">(</font><font color=Green>Then</font> m <font color="#808080">(</font><font color=Green>Bind</font> n f<font color="#808080">)</font><font color="#808080">)</font>          <font color=Blue>-- Monad law 3'</font>
removeBind <font color="#808080">(</font><font color=Green>Bind</font> m f<font color="#808080">)</font>  g  <font color="#808080">=</font>  opt <font color="#808080">(</font><font color=Green>Bind</font> m <font color="#808080">(</font><font color="#808080">\</font>a<font color="#808080">-&gt;</font> <font color=Green>Bind</font> <font color="#808080">(</font>f a<font color="#808080">)</font> g<font color="#808080">)</font><font color="#808080">)</font> <font color=Blue>-- Monad law 3</font>

removeThen <font color="#808080">::</font> <font color=Green>S2</font> s a <font color="#808080">-&gt;</font> <font color=Green>S2</font> s b <font color="#808080">-&gt;</font> <font color=Green>S3</font> s b
removeThen <font color="#808080">(</font><font color=Green>Return</font> a<font color="#808080">)</font>  n  <font color="#808080">=</font>  opt n                            <font color=Blue>-- Monad law 1'</font>
removeThen <font color=Green>Get</font>         n  <font color="#808080">=</font>  opt n                            <font color=Blue>-- prop. of Get</font>
removeThen <font color="#808080">(</font><font color=Green>Put</font> s<font color="#808080">)</font>     n  <font color="#808080">=</font>  <font color=Green>PutThen</font> s <font color="#808080">(</font>opt n<font color="#808080">)</font>                <font color=Blue>-- new constructor</font>
removeThen <font color="#808080">(</font><font color=Green>Then</font> m n<font color="#808080">)</font>  o  <font color="#808080">=</font>  opt <font color="#808080">(</font><font color=Green>Then</font> m <font color="#808080">(</font><font color=Green>Then</font> n o<font color="#808080">)</font><font color="#808080">)</font>          <font color=Blue>-- Monad law 3''</font>
removeThen <font color="#808080">(</font><font color=Green>Bind</font> m f<font color="#808080">)</font>  n  <font color="#808080">=</font>  opt <font color="#808080">(</font><font color=Green>Bind</font> m <font color="#808080">(</font><font color="#808080">\</font>a<font color="#808080">-&gt;</font> <font color=Green>Then</font> <font color="#808080">(</font>f a<font color="#808080">)</font> n<font color="#808080">)</font><font color="#808080">)</font> <font color=Blue>-- Monad law 3'''</font>


<font color=Blue>{-
-- Alternative right-hand-sides for some of the cases:
removeBind (Then m n)  f  =  removeThen m (Bind n f)
removeBind (Bind m f)  g  =  removeBind m (\a-&gt; Bind (f a) g)

removeThen (Then m n)  o  =  removeThen m (Then n o)
removeThen (Bind m f)  n  =  removeBind m (\a-&gt; Then (f a) n)
-}</font>

removeBindThen <font color="#808080">::</font>
  <font color=Green>S2</font> s a1 <font color="#808080">-&gt;</font> <font color=Green>S2</font> s a2 <font color="#808080">-&gt;</font> <font color="#808080">(</font>a2 <font color="#808080">-&gt;</font> <font color=Green>S2</font> s a<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>AllEq</font> <font color="#808080">(</font><font color=Green>S3</font> s a<font color="#808080">)</font>
removeBindThen m n f <font color="#808080">=</font> <font color=Green>AllEq</font>
  <font color="#808080">[</font> removeBind <font color="#808080">(</font><font color=Green>Then</font> m n<font color="#808080">)</font> f  
  <font color="#808080">,</font> <font color=Blue>-- def. of opt for Bind</font>
    opt <font color="#808080">(</font><font color=Green>Bind</font> <font color="#808080">(</font><font color=Green>Then</font> m n<font color="#808080">)</font> f<font color="#808080">)</font>
  <font color="#808080">,</font> <font color=Blue>-- Monad law 3 (specialised for Then (&gt;&gt;))</font>
    opt <font color="#808080">(</font><font color=Green>Then</font> m <font color="#808080">(</font><font color=Green>Bind</font> n f<font color="#808080">)</font><font color="#808080">)</font>         
  <font color="#808080">,</font> <font color=Blue>-- def. of opt for Then</font>
    removeThen m <font color="#808080">(</font><font color=Green>Bind</font> n f<font color="#808080">)</font>
  <font color="#808080">]</font>

removeBindBind m f g <font color="#808080">=</font> <font color=Green>AllEq</font>
  <font color="#808080">[</font> removeBind <font color="#808080">(</font><font color=Green>Bind</font> m f<font color="#808080">)</font> g
  <font color="#808080">,</font> <font color=Blue>-- def. opt for Bind</font>
    opt <font color="#808080">(</font><font color=Green>Bind</font> <font color="#808080">(</font><font color=Green>Bind</font> m f<font color="#808080">)</font> g<font color="#808080">)</font>
  <font color="#808080">,</font> <font color=Blue>-- Monad law 3</font>
    opt <font color="#808080">(</font><font color=Green>Bind</font> m <font color="#808080">(</font><font color="#808080">\</font>a<font color="#808080">-&gt;</font> <font color=Green>Bind</font> <font color="#808080">(</font>f a<font color="#808080">)</font> g<font color="#808080">)</font><font color="#808080">)</font>
  <font color="#808080">,</font> <font color=Blue>-- def. of opt for Bind</font>
    removeBind m <font color="#808080">(</font><font color="#808080">\</font>a<font color="#808080">-&gt;</font> <font color=Green>Bind</font> <font color="#808080">(</font>f a<font color="#808080">)</font> g<font color="#808080">)</font>
  <font color="#808080">]</font>

removeThenThen m n o <font color="#808080">=</font> <font color=Green>AllEq</font>
  <font color="#808080">[</font> removeThen <font color="#808080">(</font><font color=Green>Then</font> m n<font color="#808080">)</font>  o  
  <font color="#808080">,</font> <font color=Blue>-- Monad law 3''</font>
    opt <font color="#808080">(</font><font color=Green>Then</font> m <font color="#808080">(</font><font color=Green>Then</font> n o<font color="#808080">)</font><font color="#808080">)</font>
  <font color="#808080">,</font> <font color=Blue>-- def. of opt for Then</font>
    removeThen m <font color="#808080">(</font><font color=Green>Then</font> n o<font color="#808080">)</font>
  <font color="#808080">]</font>

removeThenBind m f n <font color="#808080">=</font> <font color=Green>AllEq</font>
  <font color="#808080">[</font> removeThen <font color="#808080">(</font><font color=Green>Bind</font> m f<font color="#808080">)</font>  n  
  <font color="#808080">,</font> <font color=Blue>-- Monad law 3'''</font>
    opt <font color="#808080">(</font><font color=Green>Bind</font> m <font color="#808080">(</font><font color="#808080">\</font>a<font color="#808080">-&gt;</font> <font color=Green>Then</font> <font color="#808080">(</font>f a<font color="#808080">)</font> n<font color="#808080">)</font><font color="#808080">)</font>
  <font color="#808080">,</font> <font color=Blue>-- def. of opt for Bind</font>
    removeBind m <font color="#808080">(</font><font color="#808080">\</font>a<font color="#808080">-&gt;</font> <font color=Green>Then</font> <font color="#808080">(</font>f a<font color="#808080">)</font> n<font color="#808080">)</font>
  <font color="#808080">]</font>

<font color=Blue>-- --------------</font>
<font color=Blue>-- Below is some supporting code to sanity-check the exam answers.</font>

runS3 <font color="#808080">::</font> <font color=Green>S3</font> s a      <font color="#808080">-&gt;</font> <font color="#808080">(</font>s <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">,</font> s<font color="#808080">)</font><font color="#808080">)</font>
runS3 <font color="#808080">(</font><font color=Green>Ret3</font> a<font color="#808080">)</font>       <font color="#808080">=</font>  <font color="#808080">\</font>s <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">,</font> s<font color="#808080">)</font> 
runS3 <font color="#808080">(</font><font color=Green>GetBind</font> f<font color="#808080">)</font>    <font color="#808080">=</font>  <font color="#808080">\</font>s <font color="#808080">-&gt;</font> runS3 <font color="#808080">(</font>f s<font color="#808080">)</font> s
runS3 <font color="#808080">(</font><font color=Green>PutThen</font> s m<font color="#808080">)</font>  <font color="#808080">=</font>  <font color="#808080">\</font><u><font color="#804000">_</font></u> <font color="#808080">-&gt;</font> runS3 m s

saneOpt m <font color="#808080">=</font> <font color="#808080">\</font>s <font color="#808080">-&gt;</font> runS2 m s <font color="#800080">==</font> runS3 <font color="#808080">(</font>opt m<font color="#808080">)</font> s

testOpt <font color="#808080">=</font> quickCheck <font color="#808080">(</font>saneOpt <font color="#800080">.</font> compileMState<font color="#808080">)</font>

<font color=Blue>-- examples:</font>
inp1 <font color="#808080">=</font> <font color=Green>MThen</font> <font color="#808080">(</font><font color=Green>MPut</font> <font color=Green>True</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>MBind</font> <font color="#808080">(</font><font color=Green>MThen</font> <font color="#808080">(</font><font color=Green>MPut</font> <font color=Green>True</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>MReturn</font> <font color=Green>False</font><font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>A2MState</font> <font color="#808080">(</font><font color=Green>MThen</font> <font color="#808080">(</font><font color=Green>MPut</font> <font color=Green>True</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>MReturn</font> <font color=Green>False</font><font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>MReturn</font> <font color=Green>True</font><font color="#808080">)</font><font color="#808080">)</font><font color="#808080">)</font>
inp2 <font color="#808080">=</font> <font color=Green>MThen</font> <font color="#808080">(</font><font color=Green>MPut</font> <font color=Green>False</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>MReturn</font> <font color=Green>True</font><font color="#808080">)</font>

<font color=Blue>-- S3 s is also a state monad</font>
<u><font color="#804000">instance</font></u> <font color=Green>Monad</font> <font color="#808080">(</font><font color=Green>S3</font> s<font color="#808080">)</font> <u><font color="#804000">where</font></u> <font color="#808080">{</font>return <font color="#808080">=</font> <font color=Green>Ret3</font><font color="#808080">;</font> <font color="#808080">(</font><font color="#800080">&gt;&gt;=</font><font color="#808080">)</font> <font color="#808080">=</font> bind3<font color="#808080">}</font>
<u><font color="#804000">instance</font></u> <font color=Green>MonadState</font> s <font color="#808080">(</font><font color=Green>S3</font> s<font color="#808080">)</font> <u><font color="#804000">where</font></u> <font color="#808080">{</font>put <font color="#808080">=</font> put3<font color="#808080">;</font> get <font color="#808080">=</font> get3<font color="#808080">}</font>

bind3 <font color="#808080">::</font> <font color=Green>S3</font> s a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color=Green>S3</font> s b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>S3</font> s b
bind3 <font color="#808080">(</font><font color=Green>Ret3</font> a<font color="#808080">)</font>       f  <font color="#808080">=</font>  f a
bind3 <font color="#808080">(</font><font color=Green>GetBind</font> f<font color="#808080">)</font>    g  <font color="#808080">=</font>  <font color=Green>GetBind</font> <font color="#808080">(</font><font color="#808080">\</font>s<font color="#808080">-&gt;</font> bind3 <font color="#808080">(</font>f s<font color="#808080">)</font> g<font color="#808080">)</font>
bind3 <font color="#808080">(</font><font color=Green>PutThen</font> s m<font color="#808080">)</font>  f  <font color="#808080">=</font>  <font color=Green>PutThen</font> s <font color="#808080">(</font>bind3 m f<font color="#808080">)</font>
  

<font color=Blue>-- Now, how can we use the put-* laws?</font>
opt3 <font color="#808080">::</font> <font color=Green>S3</font> s a <font color="#808080">-&gt;</font> <font color=Green>S3</font> s a  
opt3 <font color="#808080">(</font><font color=Green>PutThen</font> <u><font color="#804000">_</font></u> <font color="#808080">(</font><font color=Green>PutThen</font> s m<font color="#808080">)</font><font color="#808080">)</font>  <font color="#808080">=</font>  <font color=Green>PutThen</font> s m  <font color=Blue>-- put-put</font>
opt3 <font color="#808080">(</font><font color=Green>PutThen</font> s <font color="#808080">(</font><font color=Green>GetBind</font> f<font color="#808080">)</font><font color="#808080">)</font>    <font color="#808080">=</font>  <font color=Green>PutThen</font> s <font color="#808080">(</font>opt3 <font color="#808080">(</font>f s<font color="#808080">)</font><font color="#808080">)</font> <font color=Blue>-- put-get</font>

saneOpt3 m <font color="#808080">=</font> <font color="#808080">\</font>s <font color="#808080">-&gt;</font> runS3 m' s <font color="#800080">==</font> runS3 <font color="#808080">(</font>opt3 m'<font color="#808080">)</font> s
  <u><font color="#804000">where</font></u> m' <font color="#808080">=</font> opt m

testOpt3 <font color="#808080">=</font> quickCheck <font color="#808080">(</font>saneOpt <font color="#800080">.</font> compileMState<font color="#808080">)</font>

<font color=Blue>-- --------------</font>




<font color=Blue>-- --------------------------------------------------------------</font>
<font color=Blue>-- Equality check:</font>
<font color="#808080">(</font><font color="#800080">=.=</font><font color="#808080">)</font> <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Eq</font> a<font color="#808080">,</font> <font color=Green>Eq</font> s<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>S2</font> s a <font color="#808080">-&gt;</font> <font color=Green>S2</font> s a <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
m <font color="#800080">=.=</font> n <font color="#808080">=</font> <font color="#808080">\</font>s <font color="#808080">-&gt;</font> runS2 m s <font color="#800080">==</font> runS2 n s

<u><font color="#804000">type</font></u> <font color=Green>S</font> <font color="#808080">=</font> <font color=Green>Bool</font>
getget' <font color="#808080">::</font> <font color=Green>Fun</font> <font color="#808080">-&gt;</font> <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
getget' <font color="#808080">(</font><font color=Green>Fun</font> fun<font color="#808080">)</font> <font color="#808080">=</font> getget <font color="#808080">(</font><font color="#808080">\</font>s s' <font color="#808080">-&gt;</font> compileMState <font color="#808080">(</font>fun s s'<font color="#808080">)</font><font color="#808080">)</font>

putput' <font color="#808080">::</font> <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
putput' <font color="#808080">=</font> putput

putget' <font color="#808080">::</font> <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
putget' <font color="#808080">=</font> putget

getput' <font color="#808080">::</font> <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
getput' <font color="#808080">=</font> getput <font color="#808080">(</font>undefined <font color="#808080">::</font> <font color=Green>S2</font> <font color=Green>S</font> <font color=Green>()</font><font color="#808080">)</font>
  
test1 <font color="#808080">=</font> <u><font color="#804000">do</font></u> quickCheck getget'
           quickCheck putput'
           quickCheck putget'
           quickCheck getput'

<u><font color="#804000">newtype</font></u> <font color=Green>Fun</font> <font color="#808080">=</font> <font color=Green>Fun</font> <font color="#808080">{</font>unFun <font color="#808080">::</font> <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>MState</font><font color="#808080">}</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Arbitrary</font><font color="#808080">)</font>

<u><font color="#804000">instance</font></u> <font color=Green>Show</font> <font color=Green>Fun</font> <u><font color="#804000">where</font></u>
  show <font color="#808080">=</font> showFun
  
showFun <font color="#808080">(</font><font color=Green>Fun</font> f<font color="#808080">)</font> <font color="#808080">=</font> concatMap show <font color="#808080">[</font>f x y <font color="#808080">|</font> x <font color="#808080">&lt;-</font> <font color="#808080">[</font><font color=Green>False</font><font color="#808080">,</font> <font color=Green>True</font><font color="#808080">]</font><font color="#808080">,</font> y <font color="#808080">&lt;-</font> <font color="#808080">[</font><font color=Green>False</font><font color="#808080">,</font> <font color=Green>True</font><font color="#808080">]</font><font color="#808080">]</font>

<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>Bounded</font> s<font color="#808080">,</font> <font color=Green>Enum</font> s<font color="#808080">,</font> <font color=Green>Show</font> s<font color="#808080">,</font> <font color=Green>Show</font> a<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>Show</font> <font color="#808080">(</font><font color=Green>S2</font> s a<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  show <font color="#808080">=</font> showS2

showS2 sm <font color="#808080">=</font> concatMap show <font color="#808080">[</font>g s <font color="#808080">|</font> s <font color="#808080">&lt;-</font> <font color="#808080">[</font>minBound<font color="#808080">..</font>maxBound<font color="#808080">]</font><font color="#808080">]</font>
  <u><font color="#804000">where</font></u> g <font color="#808080">=</font> runS2 sm
        



<font color=Blue>{-
-- A polymorphic instance does not work with the GADT S2
instance (Arbitrary s, Arbitrary a) =&gt; Arbitrary (S2 s a) where
  arbitrary = arbitraryS2
  
arbitraryS2 :: (Arbitrary s, Arbitrary a) =&gt; Gen (S2 s a)
arbitraryS2 = oneof 
  [ Return &lt;$&gt; arbitrary
  , Bind   &lt;$&gt; arbitrary &lt;*&gt; arbitrary  -- ambiguous
  , Then   &lt;$&gt; arbitrary &lt;*&gt; arbitrary  -- ambiguous
  , pure Get                            -- type mismatch
  , Put    &lt;$&gt; arbitrary                -- type mismatch
  ]
-}</font>

<u><font color="#804000">type</font></u> <font color=Green>A</font> <font color="#808080">=</font> <font color=Green>Bool</font>
<u><font color="#804000">data</font></u> <font color=Green>MState</font> <u><font color="#804000">where</font></u> <font color=Blue>-- a result-monomorphic version of S2 s a</font>
  <font color=Green>MReturn</font>  <font color="#808080">::</font>  <font color=Green>A</font> <font color="#808080">-&gt;</font> <font color=Green>MState</font>
  <font color=Green>MBind</font>    <font color="#808080">::</font>  <font color=Green>MState</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>A2MState</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>MState</font>
  <font color=Green>MThen</font>    <font color="#808080">::</font>  <font color=Green>MState'</font> <font color="#808080">-&gt;</font> <font color=Green>MState</font> <font color="#808080">-&gt;</font> <font color=Green>MState</font>
  <font color=Green>MGet</font>     <font color="#808080">::</font>  <font color=Green>MState</font>
  <u><font color="#804000">deriving</font></u> <font color=Green>Show</font>

<u><font color="#804000">data</font></u> <font color=Green>MState'</font> <u><font color="#804000">where</font></u>
  <font color=Green>MPut</font>     <font color="#808080">::</font>  <font color=Green>S</font> <font color="#808080">-&gt;</font> <font color=Green>MState'</font>
  <u><font color="#804000">deriving</font></u> <font color=Green>Show</font>

compileMState' <font color="#808080">::</font> <font color=Green>MState'</font> <font color="#808080">-&gt;</font> <font color=Green>S2</font> <font color=Green>S</font> <font color=Green>()</font>
compileMState' <font color="#808080">(</font><font color=Green>MPut</font> s<font color="#808080">)</font>     <font color="#808080">=</font>  <font color=Green>Put</font> s


<u><font color="#804000">data</font></u> <font color=Green>A2MState</font> <font color="#808080">=</font> <font color=Green>A2MState</font> <font color=Green>MState</font> <font color=Green>MState</font> <font color=Blue>-- False and True cases</font>
  <u><font color="#804000">deriving</font></u> <font color=Green>Show</font>  

compileMState <font color="#808080">::</font> <font color=Green>MState</font> <font color="#808080">-&gt;</font> <font color=Green>S2</font> <font color=Green>S</font> <font color=Green>A</font>
compileMState <font color="#808080">(</font><font color=Green>MReturn</font> a<font color="#808080">)</font>  <font color="#808080">=</font>  <font color=Green>Return</font> a
compileMState <font color="#808080">(</font><font color=Green>MBind</font> m f<font color="#808080">)</font>  <font color="#808080">=</font>  <font color=Green>Bind</font> <font color="#808080">(</font>compileMState m<font color="#808080">)</font> <font color="#808080">(</font>compileA2MState f<font color="#808080">)</font>
compileMState <font color="#808080">(</font><font color=Green>MThen</font> m n<font color="#808080">)</font>  <font color="#808080">=</font>  <font color=Green>Then</font> <font color="#808080">(</font>compileMState' m<font color="#808080">)</font> <font color="#808080">(</font>compileMState n<font color="#808080">)</font>
compileMState <font color="#808080">(</font><font color=Green>MGet</font><font color="#808080">)</font>       <font color="#808080">=</font>  <font color=Green>Get</font>
  
compileA2MState <font color="#808080">::</font> <font color=Green>A2MState</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>A</font> <font color="#808080">-&gt;</font> <font color=Green>S2</font> <font color=Green>S</font> <font color=Green>A</font><font color="#808080">)</font>
compileA2MState <font color="#808080">(</font><font color=Green>A2MState</font> f t<font color="#808080">)</font> a <font color="#808080">=</font> compileMState <font color="#800080">$</font> <u><font color="#804000">if</font></u> a <u><font color="#804000">then</font></u> t <u><font color="#804000">else</font></u> f

<u><font color="#804000">instance</font></u> <font color=Green>Arbitrary</font> <font color=Green>MState</font> <u><font color="#804000">where</font></u>
  arbitrary <font color="#808080">=</font> arbitraryMState
  
<u><font color="#804000">instance</font></u> <font color=Green>Arbitrary</font> <font color=Green>MState'</font> <u><font color="#804000">where</font></u>
  arbitrary <font color="#808080">=</font> arbitraryMState'

<u><font color="#804000">instance</font></u> <font color=Green>Arbitrary</font> <font color=Green>A2MState</font> <u><font color="#804000">where</font></u>
  arbitrary <font color="#808080">=</font> arbitraryA2MState

arbitraryMState' <font color="#808080">::</font> <font color=Green>Gen</font> <font color=Green>MState'</font>
arbitraryMState' <font color="#808080">=</font> <font color=Green>MPut</font> <font color="#800080">&lt;$&gt;</font> arbitrary

arbitraryMState <font color="#808080">::</font> <font color=Green>Gen</font> <font color=Green>MState</font>
arbitraryMState <font color="#808080">=</font> oneof 
  <font color="#808080">[</font> <font color=Green>MReturn</font> <font color="#800080">&lt;$&gt;</font> arbitrary
  <font color="#808080">,</font> <font color=Green>MBind</font>   <font color="#800080">&lt;$&gt;</font> arbitrary <font color="#800080">&lt;*&gt;</font> arbitrary
  <font color="#808080">,</font> <font color=Green>MThen</font>   <font color="#800080">&lt;$&gt;</font> arbitrary <font color="#800080">&lt;*&gt;</font> arbitrary
  <font color="#808080">,</font> pure <font color=Green>MGet</font>                            <font color=Blue>-- type cheat - state S = result type A</font>
  <font color="#808080">]</font>

arbitraryA2MState <font color="#808080">::</font> <font color=Green>Gen</font> <font color=Green>A2MState</font>
arbitraryA2MState <font color="#808080">=</font> <font color=Green>A2MState</font> <font color="#800080">&lt;$&gt;</font> arbitrary <font color="#800080">&lt;*&gt;</font> arbitrary


<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Sanity checking of the "proofs" - not needed on the exam:</font>

<font color=Blue>-- Straw-man proofs in Haskell (just a list of supposedly equal expr.)</font>
<u><font color="#804000">newtype</font></u> <font color=Green>AllEq</font> a <font color="#808080">=</font> <font color=Green>AllEq</font> <font color="#808080">[</font>a<font color="#808080">]</font> 
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Arbitrary</font><font color="#808080">)</font>
<font color=Blue>{- 
mytest (AllEq ms) = forAll arbitrary $ \e -&gt; 
                    allEq $ map (flip runS2 e) ms

instance (Arbitrary s, Show s, Eq a, Eq s) =&gt;
         Testable (AllEq (S2 s a)) where 
  property = mytest
-}</font>

<u><font color="#804000">instance</font></u> <font color=Green>Eq</font> a <font color="#808080">=&gt;</font> <font color=Green>Testable</font> <font color="#808080">(</font><font color=Green>AllEq</font> a<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  property <font color="#808080">=</font> propertyAllEq 
                          
propertyAllEq <font color="#808080">::</font> <font color=Green>Eq</font> a <font color="#808080">=&gt;</font> <font color=Green>AllEq</font> a <font color="#808080">-&gt;</font> <font color=Green>Property</font>
propertyAllEq <font color="#808080">(</font><font color=Green>AllEq</font> xs<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>QC</font><font color="#800080">.</font>property <font color="#800080">$</font> <font color=Green>QC</font><font color="#800080">.</font>liftBool <font color="#800080">$</font> allEq xs
    
allEq <font color=Green>[]</font>      <font color="#808080">=</font>  <font color=Green>True</font>
allEq <font color="#808080">(</font>x<b><font color="#800080">:</font></b>xs<font color="#808080">)</font>  <font color="#808080">=</font>  all <font color="#808080">(</font>x<font color="#800080">==</font><font color="#808080">)</font> xs

    

test2 <font color="#808080">=</font> <u><font color="#804000">do</font></u> quickCheck <font color="#808080">(</font><font color="#808080">\</font>s <font color="#808080">-&gt;</font> putput_proof <font color="#808080">(</font>s <font color="#808080">::</font> <font color=Green>Int</font><font color="#808080">)</font><font color="#808080">)</font>
           quickCheck <font color="#808080">(</font><font color="#808080">\</font>s <font color="#808080">-&gt;</font> putget_proof <font color="#808080">(</font>s <font color="#808080">::</font> <font color=Green>Int</font><font color="#808080">)</font><font color="#808080">)</font>

main <font color="#808080">=</font> test1 <font color="#800080">&gt;&gt;</font> test2
</pre>
</body>
</html>