<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-2014-08/Types.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE GADTs #-}</font>
<font color=Blue>-- Types: read, understand and extend Haskell programs which use advanced type system features</font>
<font color=Blue>--     Types.Class: type classes, newtypes, deriving, ...</font>
<font color=Blue>--     Types.GADT: (generalised) algebraic datatypes &amp; type families</font>
<font color=Blue>--     Types.HOT: functors, monads and monad transformers </font>

<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font> <font color="#808080">(</font>liftM2<font color="#808080">)</font>

<u><font color="#804000">data</font></u> <font color=Green>Expr</font> t <u><font color="#804000">where</font></u>
  <font color=Green>C</font>     <font color="#808080">::</font> <font color=Green>Char</font> <font color="#808080">-&gt;</font> <font color=Green>Expr</font> <font color=Green>Char</font>
  <font color=Green>I</font>     <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font>  <font color=Green>Expr</font> <font color=Green>Int</font>
  <font color="#808080">(</font><b><font color="#800080">:@</font></b><font color="#808080">)</font>  <font color="#808080">::</font> <font color=Green>Expr</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Expr</font> a <font color="#808080">-&gt;</font> <font color=Green>Expr</font> b
  <font color=Green>Nil</font>        <font color="#808080">::</font> <font color=Green>Expr</font> <font color="#808080">[</font>a<font color="#808080">]</font>
  <font color=Green>Cons</font>       <font color="#808080">::</font> <font color=Green>Expr</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font><font color="#808080">)</font>
  <font color=Green>Replicate</font>  <font color="#808080">::</font> <font color=Green>Expr</font> <font color="#808080">(</font><font color=Green>Int</font> <font color="#808080">-&gt;</font> a <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font><font color="#808080">)</font>
  <font color=Green>Length</font>     <font color="#808080">::</font> <font color=Green>Expr</font> <font color="#808080">(</font><font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Int</font><font color="#808080">)</font>
<font color=Blue>-- Added later</font>
  <font color=Green>V</font>   <font color="#808080">::</font> <font color=Green>Name</font> <font color="#808080">-&gt;</font> <font color=Green>Expr</font> <font color=Green>String</font>

<u><font color="#804000">type</font></u> <font color=Green>Name</font> <font color="#808080">=</font> <font color=Green>Int</font>

eval <font color="#808080">::</font> <font color=Green>Expr</font> t <font color="#808080">-&gt;</font> t
eval <font color="#808080">(</font><font color=Green>C</font> c<font color="#808080">)</font>      <font color="#808080">=</font> c
eval <font color="#808080">(</font><font color=Green>I</font> i<font color="#808080">)</font>      <font color="#808080">=</font> i
eval <font color="#808080">(</font>f <b><font color="#800080">:@</font></b> x<font color="#808080">)</font>   <font color="#808080">=</font> <font color="#808080">(</font>eval f<font color="#808080">)</font> <font color="#808080">(</font>eval x<font color="#808080">)</font>
eval <font color=Green>Nil</font>        <font color="#808080">=</font> <font color=Green>[]</font>
eval <font color=Green>Cons</font>       <font color="#808080">=</font> <font color="#808080">(</font><b><font color="#800080">:</font></b><font color="#808080">)</font>
eval <font color=Green>Replicate</font>  <font color="#808080">=</font> replicate
eval <font color=Green>Length</font>     <font color="#808080">=</font> length

test <font color="#808080">=</font> eval <font color="#808080">(</font><font color=Green>Replicate</font> <b><font color="#800080">:@</font></b> <font color="#808080">(</font><font color=Green>I</font> <font color=Magenta>5</font><font color="#808080">)</font> <b><font color="#800080">:@</font></b> <font color=Green>Nil</font><font color="#808080">)</font>

stringLit <font color="#808080">::</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>Expr</font> <font color=Green>String</font>
stringLit <font color="#808080">=</font> foldr <font color="#808080">(</font><font color="#808080">\</font>x e <font color="#808080">-&gt;</font> <font color=Green>Cons</font> <b><font color="#800080">:@</font></b> <font color=Green>C</font> x <b><font color="#800080">:@</font></b> e<font color="#808080">)</font> <font color=Green>Nil</font>

<font color=Blue>-- Added later:</font>
eval2 <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Name</font> <font color="#808080">-&gt;</font> <font color=Green>Maybe</font> <font color=Green>String</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Expr</font> t <font color="#808080">-&gt;</font> <font color=Green>Maybe</font> t
eval2 lookup <font color="#808080">(</font><font color=Green>V</font> v<font color="#808080">)</font>  <font color="#808080">=</font> lookup v
eval2 l <font color="#808080">(</font><font color=Green>C</font> c<font color="#808080">)</font>       <font color="#808080">=</font> <font color=Green>Just</font> c
eval2 l <font color="#808080">(</font><font color=Green>I</font> i<font color="#808080">)</font>       <font color="#808080">=</font> <font color=Green>Just</font> i
eval2 l <font color="#808080">(</font>f <b><font color="#800080">:@</font></b> x<font color="#808080">)</font>    <font color="#808080">=</font> liftM2 <font color="#808080">(</font><font color="#800080">$</font><font color="#808080">)</font> <font color="#808080">(</font>eval2 l f<font color="#808080">)</font> <font color="#808080">(</font>eval2 l x<font color="#808080">)</font>
eval2 l <font color=Green>Nil</font>         <font color="#808080">=</font> <font color=Green>Just</font> <font color=Green>[]</font>
eval2 l <font color=Green>Cons</font>        <font color="#808080">=</font> <font color=Green>Just</font> <font color="#808080">(</font><b><font color="#800080">:</font></b><font color="#808080">)</font>
eval2 l <font color=Green>Replicate</font>   <font color="#808080">=</font> <font color=Green>Just</font> replicate
eval2 l <font color=Green>Length</font>      <font color="#808080">=</font> <font color=Green>Just</font> length

<font color=Blue>-- Changes: </font>
<font color=Blue>-- * new constructor for Int-labelled variables</font>
<font color=Blue>-- * Monadic (to handle variable lookup failure)</font>
<font color=Blue>-- * eval2 has a new case for the variables</font>

test2 <font color="#808080">=</font> eval2 <font color="#808080">(</font>const <font color="#808080">(</font><font color=Green>Just</font> <font color=Magenta>"hej"</font><font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Replicate</font> <b><font color="#800080">:@</font></b> <font color="#808080">(</font><font color=Green>Length</font> <b><font color="#800080">:@</font></b> <font color="#808080">(</font><font color=Green>V</font> <font color=Magenta>1</font><font color="#808080">)</font><font color="#808080">)</font> <b><font color="#800080">:@</font></b> <font color=Green>V</font> <font color=Magenta>1</font><font color="#808080">)</font>

<font color=Blue>----------------------------------------------------------------</font>
</pre>
</body>
</html>