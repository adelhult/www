<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-10mar/Problem3/QuestionCode.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, FlexibleContexts,
    UndecidableInstances, GeneralizedNewtypeDeriving #-}</font>

<u><font color="#804000">module</font></u> <font color=Green>Problem3</font><font color="#800080">.</font><font color=Green>QuestionCode</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>Problem2</font><font color="#800080">.</font><font color=Green>Prod</font> <font color=Blue>-- contains the |Prod m n| monad instance from Problem 2</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Identity</font>  <u><font color="#804000">as</font></u>  <font color=Green>CMI</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font>     <u><font color="#804000">as</font></u>  <font color=Green>CMS</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Error</font>     <u><font color="#804000">as</font></u>  <font color=Green>CME</font>

<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> s m<font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> s n<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> s <font color="#808080">(</font><font color=Green>Prod</font> m n<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  get    <font color="#808080">=</font>  <font color=Green>Prod</font> <font color="#808080">(</font><font color=Green>CMS</font><font color="#800080">.</font>get<font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font>get<font color="#808080">)</font>
  put s  <font color="#808080">=</font>  <font color=Green>Prod</font> <font color="#808080">(</font><font color=Green>CMS</font><font color="#800080">.</font>put s<font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font>put s<font color="#808080">)</font>
<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>CME</font><font color="#800080">.</font><font color=Green>MonadError</font> e m<font color="#808080">,</font> <font color=Green>CME</font><font color="#800080">.</font><font color=Green>MonadError</font> e n<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>CME</font><font color="#800080">.</font><font color=Green>MonadError</font> e <font color="#808080">(</font><font color=Green>Prod</font> m n<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  throwError e <font color="#808080">=</font> <font color=Green>Prod</font> <font color="#808080">(</font><font color=Green>CME</font><font color="#800080">.</font>throwError e<font color="#808080">,</font> <font color=Green>CME</font><font color="#800080">.</font>throwError e<font color="#808080">)</font>
  catchError mnx f <font color="#808080">=</font> <font color=Green>Prod</font> <font color="#808080">(</font> <font color=Green>CME</font><font color="#800080">.</font>catchError <font color="#808080">(</font>fstP mnx<font color="#808080">)</font> <font color="#808080">(</font>fstP <font color="#800080">.</font> f<font color="#808080">)</font>
                          <font color="#808080">,</font> <font color=Green>CME</font><font color="#800080">.</font>catchError <font color="#808080">(</font>sndP mnx<font color="#808080">)</font> <font color="#808080">(</font>sndP <font color="#800080">.</font> f<font color="#808080">)</font> <font color="#808080">)</font>

<u><font color="#804000">type</font></u> <font color=Green>Store</font>  <font color="#808080">=</font>  <font color=Green>Integer</font>
<u><font color="#804000">type</font></u> <font color=Green>Err</font>    <font color="#808080">=</font>  <font color=Green>String</font>
<u><font color="#804000">newtype</font></u> <font color=Green>Eval1</font> a <font color="#808080">=</font> <font color=Green>Eval1</font><font color="#808080">{</font> unEval1 <font color="#808080">::</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>StateT</font> <font color=Green>Store</font> <font color="#808080">(</font><font color=Green>CME</font><font color="#800080">.</font><font color=Green>ErrorT</font> <font color=Green>Err</font> <font color=Green>CMI</font><font color="#800080">.</font><font color=Green>Identity</font><font color="#808080">)</font> a <font color="#808080">}</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Monad</font><font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> <font color=Green>Store</font><font color="#808080">,</font> <font color=Green>CME</font><font color="#800080">.</font><font color=Green>MonadError</font> <font color=Green>Err</font><font color="#808080">)</font>

<u><font color="#804000">newtype</font></u> <font color=Green>Eval2</font> a <font color="#808080">=</font> <font color=Green>Eval2</font><font color="#808080">{</font> unEval2 <font color="#808080">::</font> <font color=Green>CME</font><font color="#800080">.</font><font color=Green>ErrorT</font> <font color=Green>Err</font> <font color="#808080">(</font><font color=Green>CMS</font><font color="#800080">.</font><font color=Green>StateT</font> <font color=Green>Store</font> <font color=Green>CMI</font><font color="#800080">.</font><font color=Green>Identity</font><font color="#808080">)</font> a <font color="#808080">}</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Monad</font><font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> <font color=Green>Store</font><font color="#808080">,</font> <font color=Green>CME</font><font color="#800080">.</font><font color=Green>MonadError</font> <font color=Green>Err</font><font color="#808080">)</font>

startStateFrom <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> state <font color="#808080">-&gt;</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>StateT</font> state m a <font color="#808080">-&gt;</font> m a
startStateFrom <font color="#808080">=</font> flip <font color=Green>CMS</font><font color="#800080">.</font>evalStateT

emptyStore <font color="#808080">::</font> <font color=Green>Store</font>
emptyStore <font color="#808080">=</font> <font color=Magenta>0</font>

runEval1 <font color="#808080">::</font> <font color=Green>Eval1</font> a <font color="#808080">-&gt;</font> <font color=Green>Either</font> <font color=Green>Err</font> a
runEval1 <font color="#808080">=</font> <font color=Green>CMI</font><font color="#800080">.</font>runIdentity <font color="#800080">.</font> <font color=Green>CME</font><font color="#800080">.</font>runErrorT <font color="#800080">.</font> startStateFrom  emptyStore <font color="#800080">.</font> unEval1

runEval2 <font color="#808080">::</font> <font color=Green>Eval2</font> a <font color="#808080">-&gt;</font> <font color=Green>Either</font> <font color=Green>Err</font> a
runEval2 <font color="#808080">=</font> <font color=Green>CMI</font><font color="#800080">.</font>runIdentity <font color="#800080">.</font> startStateFrom  emptyStore <font color="#800080">.</font> <font color=Green>CME</font><font color="#800080">.</font>runErrorT <font color="#800080">.</font> unEval2

<font color="#808080">(</font><font color="#800080">-*-</font><font color="#808080">)</font> <font color="#808080">::</font> <font color="#808080">(</font>a1<font color="#808080">-&gt;</font>a2<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>b1<font color="#808080">-&gt;</font>b2<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>a1<font color="#808080">,</font>b1<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>a2<font color="#808080">,</font>b2<font color="#808080">)</font>
f <font color="#800080">-*-</font> g <font color="#808080">=</font> <font color="#808080">\</font><font color="#808080">(</font>a<font color="#808080">,</font>b<font color="#808080">)</font><font color="#808080">-&gt;</font><font color="#808080">(</font>f a<font color="#808080">,</font> g b<font color="#808080">)</font>

<u><font color="#804000">type</font></u> <font color=Green>Test</font> <font color="#808080">=</font> <font color=Green>Prod</font> <font color=Green>Eval1</font> <font color=Green>Eval2</font>

check <font color="#808080">::</font> <font color=Green>Test</font> a <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>Either</font> <font color=Green>Err</font> a<font color="#808080">,</font> <font color=Green>Either</font> <font color=Green>Err</font> a<font color="#808080">)</font>
check <font color="#808080">=</font> <font color="#808080">(</font>runEval1 <font color="#800080">-*-</font> runEval2<font color="#808080">)</font> <font color="#800080">.</font> unProd

test1 <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>CME</font><font color="#800080">.</font><font color=Green>MonadError</font> <font color=Green>Err</font> m<font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> <font color=Green>Store</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> m <font color=Green>Store</font>
test1 <font color="#808080">=</font> <font color="#808080">(</font><u><font color="#804000">do</font></u> <font color=Green>CMS</font><font color="#800080">.</font>put <font color=Magenta>1738</font><font color="#808080">;</font> <font color=Green>CME</font><font color="#800080">.</font>throwError <font color=Magenta>"hello"</font><font color="#808080">;</font> <font color=Green>CMS</font><font color="#800080">.</font>get<font color="#808080">)</font>
          <font color="#800080">`</font><font color=Green>CME</font><font color="#800080">.</font>catchError<font color="#800080">`</font> <font color="#808080">\</font>e<font color="#808080">-&gt;</font> <font color=Green>CMS</font><font color="#800080">.</font>get

main <font color="#808080">=</font> print <font color="#808080">(</font>check test1<font color="#808080">)</font>
</pre>
</body>
</html>