<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-10mar/Problem3/Eval3.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE GeneralizedNewtypeDeriving, ScopedTypeVariables #-}</font>
<u><font color="#804000">module</font></u> <font color=Green>Problem3</font><font color="#800080">.</font><font color=Green>Eval3</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Identity</font>  <u><font color="#804000">as</font></u>  <font color=Green>CMI</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font>     <u><font color="#804000">as</font></u>  <font color=Green>CMS</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Error</font>     <u><font color="#804000">as</font></u>  <font color=Green>CME</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Reader</font>    <u><font color="#804000">as</font></u>  <font color=Green>CMR</font>
<u><font color="#804000">import</font></u> <font color=Green>Problem3</font><font color="#800080">.</font><font color=Green>QuestionCode</font>

<font color=Blue>{-
newtype Eval1 a = Eval1{ unEval1 :: CMS.StateT Store (CME.ErrorT Err CMI.Identity) a }
  deriving (Monad, CMS.MonadState Store, CME.MonadError Err)
runEval1 :: Eval1 a -&gt; Either Err a
runEval1 = CMI.runIdentity . CME.runErrorT . startStateFrom  emptyStore . unEval1
-}</font>

<u><font color="#804000">type</font></u> <font color=Green>Env</font> <font color="#808080">=</font> <font color=Green>String</font> <font color=Blue>-- just a dummy - it could be anything</font>
<u><font color="#804000">newtype</font></u> <font color=Green>Eval3</font> a <font color="#808080">=</font> <font color=Green>Eval3</font><font color="#808080">{</font> unEval3 <font color="#808080">::</font> <font color=Green>CMR</font><font color="#800080">.</font><font color=Green>ReaderT</font> <font color=Green>Env</font>
                                      <font color="#808080">(</font><font color=Green>CMS</font><font color="#800080">.</font><font color=Green>StateT</font> <font color=Green>Store</font>
                                         <font color="#808080">(</font><font color=Green>CME</font><font color="#800080">.</font><font color=Green>ErrorT</font> <font color=Green>Err</font>
                                            <font color=Green>CMI</font><font color="#800080">.</font><font color=Green>Identity</font><font color="#808080">)</font><font color="#808080">)</font> a <font color="#808080">}</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Monad</font><font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font> <font color=Green>Store</font><font color="#808080">,</font> <font color=Green>CME</font><font color="#800080">.</font><font color=Green>MonadError</font> <font color=Green>Err</font><font color="#808080">,</font>
            <font color=Green>CMR</font><font color="#800080">.</font><font color=Green>MonadReader</font> <font color=Green>Env</font><font color="#808080">)</font>

runEval3 <font color="#808080">::</font> <font color=Green>Eval3</font> a <font color="#808080">-&gt;</font> <font color=Green>Either</font> <font color=Green>Err</font> a
runEval3 <font color="#808080">=</font> <font color=Green>CMI</font><font color="#800080">.</font>runIdentity
         <font color="#800080">.</font> <font color=Green>CME</font><font color="#800080">.</font>runErrorT
         <font color="#800080">.</font> startStateFrom  emptyStore
         <font color="#800080">.</font> startEnvIn myEnv
         <font color="#800080">.</font> unEval3

startEnvIn <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> env <font color="#808080">-&gt;</font> <font color=Green>CMR</font><font color="#800080">.</font><font color=Green>ReaderT</font> env m a <font color="#808080">-&gt;</font> m a
startEnvIn <font color="#808080">=</font> flip <font color=Green>CMR</font><font color="#800080">.</font>runReaderT

myEnv <font color="#808080">::</font> <font color=Green>Env</font>
myEnv <font color="#808080">=</font> <font color=Magenta>"Szia vil√°g"</font>

<font color=Blue>-- Types: (done using where to check them)</font>
runEval3' <font color="#808080">::</font> <font color=Green>Eval3</font> a <font color="#808080">-&gt;</font> <font color=Green>Either</font> <font color=Green>Err</font> a
runEval3' <font color="#808080">(</font>mx0 <font color="#808080">::</font> <font color=Green>Eval3</font> a<font color="#808080">)</font> <font color="#808080">=</font> mx5
  <u><font color="#804000">where</font></u> mx5 <font color="#808080">::</font> <font color=Green>Either</font> <font color=Green>Err</font> a
        mx5 <font color="#808080">=</font> <font color=Green>CMI</font><font color="#800080">.</font>runIdentity mx4
        mx4 <font color="#808080">::</font> <font color=Green>CMI</font><font color="#800080">.</font><font color=Green>Identity</font> <font color="#808080">(</font><font color=Green>Either</font> <font color=Green>Err</font> a<font color="#808080">)</font>
        mx4 <font color="#808080">=</font> <font color=Green>CME</font><font color="#800080">.</font>runErrorT mx3
        mx3 <font color="#808080">::</font> <font color=Green>CME</font><font color="#800080">.</font><font color=Green>ErrorT</font> <font color=Green>Err</font> <font color=Green>CMI</font><font color="#800080">.</font><font color=Green>Identity</font> a
        mx3 <font color="#808080">=</font> startStateFrom  emptyStore mx2
        mx2 <font color="#808080">::</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>StateT</font> <font color=Green>Store</font> <font color="#808080">(</font><font color=Green>CME</font><font color="#800080">.</font><font color=Green>ErrorT</font> <font color=Green>Err</font> <font color=Green>CMI</font><font color="#800080">.</font><font color=Green>Identity</font><font color="#808080">)</font> a
        mx2 <font color="#808080">=</font> startEnvIn myEnv mx1
        mx1 <font color="#808080">::</font> <font color=Green>CMR</font><font color="#800080">.</font><font color=Green>ReaderT</font> <font color=Green>Env</font> <font color="#808080">(</font><font color=Green>CMS</font><font color="#800080">.</font><font color=Green>StateT</font> <font color=Green>Store</font> <font color="#808080">(</font><font color=Green>CME</font><font color="#800080">.</font><font color=Green>ErrorT</font> <font color=Green>Err</font> <font color=Green>CMI</font><font color="#800080">.</font><font color=Green>Identity</font><font color="#808080">)</font><font color="#808080">)</font> a
        mx1 <font color="#808080">=</font> unEval3 mx0</pre>
</body>
</html>