<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-20110823/DateSet.hs</title>
</head>
<body>
<pre><font color=Blue>-- First some interface code (not part of the exam solution)</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>Time</font><font color="#800080">.</font><font color=Green>Calendar</font> <u><font color="#804000">as</font></u> <font color=Green>DTC</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>Time</font><font color="#800080">.</font><font color=Green>Calendar</font><font color="#800080">.</font><font color=Green>OrdinalDate</font> <u><font color="#804000">as</font></u> <font color=Green>DTCO</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>Time</font><font color="#800080">.</font><font color=Green>Calendar</font><font color="#800080">.</font><font color=Green>WeekDate</font> <u><font color="#804000">as</font></u> <font color=Green>DTCW</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>Time</font><font color="#800080">.</font><font color=Green>Format</font> <u><font color="#804000">as</font></u> <font color=Green>DTF</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>System</font><font color="#800080">.</font><font color=Green>Locale</font> <u><font color="#804000">as</font></u> <font color=Green>SL</font>

<u><font color="#804000">type</font></u> <font color=Green>Date</font> <font color="#808080">=</font> <font color=Green>DTC</font><font color="#800080">.</font><font color=Green>Day</font>

weekday  <font color="#808080">::</font> <font color=Green>Date</font> <font color="#808080">-&gt;</font> <font color=Green>Weekday</font>
weekday d <font color="#808080">=</font> wd  <u><font color="#804000">where</font></u> <font color="#808080">(</font><b><font color=Magenta>_y</font></b><font color="#808080">,</font><b><font color=Magenta>_w</font></b><font color="#808080">,</font>wd<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>DTCW</font><font color="#800080">.</font>toWeekDate d

monthday <font color="#808080">::</font> <font color=Green>Date</font> <font color="#808080">-&gt;</font> <font color=Green>Monthday</font>
monthday d <font color="#808080">=</font> md  <u><font color="#804000">where</font></u> <font color="#808080">(</font><b><font color=Magenta>_y</font></b><font color="#808080">,</font><b><font color=Magenta>_m</font></b><font color="#808080">,</font>md<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>DTC</font><font color="#800080">.</font>toGregorian d

yearday  <font color="#808080">::</font> <font color=Green>Date</font> <font color="#808080">-&gt;</font> <font color=Green>Yearday</font>
yearday <font color="#808080">=</font> snd <font color="#800080">.</font> <font color=Green>DTCO</font><font color="#800080">.</font>toOrdinalDate

readD <font color="#808080">::</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>Date</font> 
readD <font color="#808080">=</font> <font color=Green>DTF</font><font color="#800080">.</font>readTime <font color=Green>SL</font><font color="#800080">.</font>defaultTimeLocale <font color=Magenta>"%Y-%m-%d"</font>
  
showD <font color="#808080">::</font> <font color=Green>Date</font> <font color="#808080">-&gt;</font> <font color=Green>String</font>
showD <font color="#808080">=</font> <font color=Green>DTC</font><font color="#800080">.</font>showGregorian  

nextD <font color="#808080">::</font> <font color=Green>Date</font> <font color="#808080">-&gt;</font> <font color=Green>Date</font>
nextD <font color="#808080">=</font> succ

epochD <font color="#808080">=</font> readD <font color=Magenta>"1970-01-01"</font>

<font color=Blue>----------------</font>
<font color=Blue>-- Start of the solution to 2b</font>
<u><font color="#804000">type</font></u> <font color=Green>Weekday</font>  <font color="#808080">=</font> <font color=Green>Int</font>
<u><font color="#804000">type</font></u> <font color=Green>Monthday</font> <font color="#808080">=</font> <font color=Green>Int</font>
<u><font color="#804000">type</font></u> <font color=Green>Yearday</font>  <font color="#808080">=</font> <font color=Green>Int</font>

<u><font color="#804000">data</font></u> <font color=Green>DateSet</font> <font color="#808080">=</font> <font color=Green>Once</font> <font color=Green>Date</font>
             <font color="#808080">|</font> <font color=Green>Daily</font>
             <font color="#808080">|</font> <font color=Green>Weekly</font>  <font color=Green>Weekday</font>
             <font color="#808080">|</font> <font color=Green>Monthly</font> <font color=Green>Monthday</font>
             <font color="#808080">|</font> <font color=Green>Yearly</font>  <font color=Green>Yearday</font>
<font color=Blue>--             | Filter (Date -&gt; Bool) DateSet  -- not part of exam question</font>
             <font color="#808080">|</font> <font color=Green>Union</font> <font color=Green>DateSet</font> <font color=Green>DateSet</font>
             <font color="#808080">|</font> <font color=Green>Intersection</font> <font color=Green>DateSet</font> <font color=Green>DateSet</font>
             <font color="#808080">|</font> <font color=Green>Start</font> <font color=Green>Date</font>  
             <font color="#808080">|</font> <font color=Green>End</font> <font color=Green>Date</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Show</font><font color="#808080">)</font> <font color=Blue>-- does not work with Filter (emb. function Date-&gt;Bool)</font>

between <font color="#808080">::</font> <font color=Green>Date</font> <font color="#808080">-&gt;</font> <font color=Green>Date</font> <font color="#808080">-&gt;</font> <font color=Green>DateSet</font>
between start end <font color="#808080">=</font> <font color=Green>Intersection</font> <font color="#808080">(</font><font color=Green>Start</font> start<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>End</font> end<font color="#808080">)</font>
<font color=Blue>-- The constructor |Once| is not necessary</font>
once <font color="#808080">::</font> <font color=Green>Date</font> <font color="#808080">-&gt;</font> <font color=Green>DateSet</font>
once d <font color="#808080">=</font> between d d

isIn <font color="#808080">::</font> <font color=Green>Date</font> <font color="#808080">-&gt;</font> <font color=Green>DateSet</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
isIn d <font color="#808080">(</font><font color=Green>Once</font> d'<font color="#808080">)</font>           <font color="#808080">=</font> d <font color="#800080">==</font> d'
isIn d  <font color=Green>Daily</font>              <font color="#808080">=</font> <font color=Green>True</font>
isIn d <font color="#808080">(</font><font color=Green>Weekly</font>  a<font color="#808080">)</font>         <font color="#808080">=</font> weekday  d  <font color="#800080">==</font> a
isIn d <font color="#808080">(</font><font color=Green>Monthly</font> a<font color="#808080">)</font>         <font color="#808080">=</font> monthday d  <font color="#800080">==</font> a
isIn d <font color="#808080">(</font><font color=Green>Yearly</font>  a<font color="#808080">)</font>         <font color="#808080">=</font> yearday  d  <font color="#800080">==</font> a
<font color=Blue>-- isIn d (Filter p ds)       = p d      &amp;&amp; isIn d ds</font>
isIn d <font color="#808080">(</font><font color=Green>Union</font> x y<font color="#808080">)</font>         <font color="#808080">=</font> isIn d x <font color="#800080">||</font> isIn d y
isIn d <font color="#808080">(</font><font color=Green>Intersection</font> x y<font color="#808080">)</font>  <font color="#808080">=</font> isIn d x <font color="#800080">&amp;&amp;</font> isIn d y
isIn d <font color="#808080">(</font><font color=Green>Start</font> s<font color="#808080">)</font>           <font color="#808080">=</font> s <font color="#800080">&lt;=</font> d
isIn d <font color="#808080">(</font><font color=Green>End</font>   e<font color="#808080">)</font>           <font color="#808080">=</font> d <font color="#800080">&lt;=</font> e

<font color=Blue>-- try to locate an upperBound</font>
upperBound <font color="#808080">::</font> <font color=Green>DateSet</font> <font color="#808080">-&gt;</font> <font color=Green>Date</font>
upperBound <font color="#808080">(</font><font color=Green>Intersection</font> x y<font color="#808080">)</font> <font color="#808080">=</font> min <font color="#808080">(</font>upperBound x<font color="#808080">)</font> <font color="#808080">(</font>upperBound y<font color="#808080">)</font>
upperBound <font color="#808080">(</font><font color=Green>Union</font> x y<font color="#808080">)</font>        <font color="#808080">=</font> max <font color="#808080">(</font>upperBound x<font color="#808080">)</font> <font color="#808080">(</font>upperBound y<font color="#808080">)</font>
upperBound <font color="#808080">(</font><font color=Green>End</font>   e<font color="#808080">)</font>          <font color="#808080">=</font> e
<font color=Blue>-- upperBound (Filter p ds)      = upperBound ds</font>
upperBound <font color="#808080">(</font><font color=Green>Once</font> d<font color="#808080">)</font>           <font color="#808080">=</font> d
upperBound <u><font color="#804000">_</font></u>                  <font color="#808080">=</font> maxDate

maxDate <font color="#808080">::</font> <font color=Green>Date</font>
maxDate <font color="#808080">=</font> readD <font color=Magenta>"9999-12-31"</font>   <font color=Blue>-- somewhat arbitrary choice</font>

<font color=Blue>-- and a lowerBound (not part of exam question)</font>
lowerBound <font color="#808080">::</font> <font color=Green>DateSet</font> <font color="#808080">-&gt;</font> <font color=Green>Date</font>
lowerBound <font color="#808080">(</font><font color=Green>Intersection</font> x y<font color="#808080">)</font> <font color="#808080">=</font> max <font color="#808080">(</font>lowerBound x<font color="#808080">)</font> <font color="#808080">(</font>lowerBound y<font color="#808080">)</font>
lowerBound <font color="#808080">(</font><font color=Green>Union</font> x y<font color="#808080">)</font>        <font color="#808080">=</font> min <font color="#808080">(</font>lowerBound x<font color="#808080">)</font> <font color="#808080">(</font>lowerBound y<font color="#808080">)</font>
lowerBound <font color="#808080">(</font><font color=Green>Start</font>   s<font color="#808080">)</font>        <font color="#808080">=</font> s
<font color=Blue>-- lowerBound (Filter p ds)      = lowerBound ds</font>
lowerBound <font color="#808080">(</font><font color=Green>Once</font> d<font color="#808080">)</font>           <font color="#808080">=</font> d
lowerBound <u><font color="#804000">_</font></u>                  <font color="#808080">=</font> minDate

minDate <font color="#808080">::</font> <font color=Green>Date</font>
minDate <font color="#808080">=</font> readD <font color=Magenta>"0000-01-01"</font>   <font color=Blue>-- somewhat arbitrary choice</font>

toList <font color="#808080">::</font> <font color=Green>DateSet</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font><font color=Green>Date</font><font color="#808080">]</font>
toList ds <font color="#808080">=</font> filter <font color="#808080">(</font><font color="#800080">`isIn`</font> ds<font color="#808080">)</font> <font color="#808080">[</font>lowerBound ds <font color="#808080">..</font> upperBound ds<font color="#808080">]</font>
<font color=Blue>-- It is OK to use just |epochD| instead of |lowerBound ds|</font>

<font color=Blue>----------------</font>
<font color=Blue>-- Example code</font>

test <font color="#808080">::</font> <font color=Green>DateSet</font>
test <font color="#808080">=</font> <font color=Green>Intersection</font> <font color="#808080">(</font>between <font color="#808080">(</font>readD <font color=Magenta>"2011-08-23"</font><font color="#808080">)</font> 
                             <font color="#808080">(</font>readD <font color=Magenta>"2011-12-20"</font><font color="#808080">)</font><font color="#808080">)</font> 
                    <font color="#808080">(</font><font color=Green>Weekly</font> <font color=Magenta>1</font><font color="#808080">)</font>

main <font color="#808080">=</font> print <font color="#808080">(</font>toList test<font color="#808080">)</font>
<font color=Blue>----------------</font>
<font color=Blue>-- Part b</font>

<font color=Blue>{- Question text: Explain briefly the following EDSL terminology in
general: deep embedding, shallow embedding, constructors, combinators
and run function.  Exemplify by referring to or contrasting with your
implementation.  

Possible answers:

* Deep embedding:

A DSL implemented near the syntax, deep down from the sematics of the
domain, is called a "deep embedding". The code above is an example -
the |DateSet| datatype directly captures the abstract syntax of the
domain, not the semantics.

* Shallow embedding:

A DSL implemented near the semantics is called a "shallow
embedding". Often it can be constructed by tupling up suitable
run-functions. The example above is not done that way (mainly because
it is a bit tricky to handle the combination of infinite and finite
lists effectively).

* constructors

Functions which build elements of the domain from "other
data". Examples include |Once|, |Daily|, |Weekly|, |Monthly|,
|Yearly|, |Start|, |End|.

* combinators 

Functions which build elements of the domain from other elements of
the domain (+perhaps some other data). Examples include |Union|,
|Intersection|.

* run functions

Functions from the domain to some semantics. In our example we have
|isIn|, |toList| and |upperBound|.

-}</font>
</pre>
</body>
</html>