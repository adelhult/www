<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-20110823/Types.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE FlexibleContexts #-}</font>
<font color=Blue>{-# LANGUAGE MultiParamTypeClasses, FlexibleInstances, 
             UndecidableInstances #-}</font>
<u><font color="#804000">module</font></u> <font color=Green>Types</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Writer</font>
<font color=Blue>-- Exam question:</font>
<u><font color="#804000">newtype</font></u> <font color=Green>MaybeT</font> m a <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#808080">{</font>runMaybeT <font color="#808080">::</font> m <font color="#808080">(</font><font color=Green>Maybe</font> a<font color="#808080">)</font><font color="#808080">}</font>
 
bindMT <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>MaybeT</font> m a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m b
x <font color="#800080">`bindMT`</font> f <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#800080">$</font> runMaybeT x <font color="#800080">&gt;&gt;=</font> 
               maybe <font color="#808080">(</font>return <font color=Green>Nothing</font><font color="#808080">)</font> 
                     <font color="#808080">(</font>runMaybeT <font color="#800080">.</font> f<font color="#808080">)</font>

returnMT <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m a
returnMT a <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#800080">$</font> return <font color="#808080">(</font><font color=Green>Just</font> a<font color="#808080">)</font>

failMT <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> t <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m a
failMT <u><font color="#804000">_</font></u> <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#800080">$</font> return <font color=Green>Nothing</font>
 
<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>Monad</font> m<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>Monad</font> <font color="#808080">(</font><font color=Green>MaybeT</font> m<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  return  <font color="#808080">=</font>  returnMT
  <font color="#808080">(</font><font color="#800080">&gt;&gt;=</font><font color="#808080">)</font>   <font color="#808080">=</font>  bindMT
  fail    <font color="#808080">=</font>  failMT

problem <font color="#808080">::</font> <font color=Green>MonadWriter</font> <font color="#808080">[</font><font color=Green>String</font><font color="#808080">]</font> m <font color="#808080">=&gt;</font> m <font color=Green>Int</font>
problem <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  tell <font color="#808080">[</font><font color=Magenta>"I fail"</font><font color="#808080">]</font>
  fail <font color=Magenta>"oops"</font>
  return <font color=Magenta>1738</font>
  error <font color=Magenta>"hej"</font> <font color=Blue>-- not part of the exam question</font>

<u><font color="#804000">type</font></u> <font color=Green>A</font> <font color="#808080">=</font> <font color=Green>WriterT</font> <font color="#808080">[</font><font color=Green>String</font><font color="#808080">]</font> <font color=Green>Maybe</font>
<u><font color="#804000">type</font></u> <font color=Green>B</font> <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#808080">(</font><font color=Green>Writer</font> <font color="#808080">[</font><font color=Green>String</font><font color="#808080">]</font><font color="#808080">)</font>

a <font color="#808080">::</font> <font color=Green>A</font> <font color=Green>Int</font>
a <font color="#808080">=</font> problem

b <font color="#808080">::</font> <font color=Green>B</font> <font color=Green>Int</font>
b <font color="#808080">=</font> problem


<font color=Blue>-- What do |runWriterT a| and |runWriter (runMaybeT b)| evaluate to?  </font>
<font color=Blue>-- Explain.</font>

testa <font color="#808080">=</font> runWriterT a
testb <font color="#808080">=</font> runWriter <font color="#808080">(</font>runMaybeT b<font color="#808080">)</font>

<font color=Blue>-- For both tests, the call to return has no effect, because the call</font>
<font color=Blue>-- to fail makes the computation fail before it gets to return.</font>

<font color=Blue>{- 
A a = WriterT [String] Maybe a ~= Maybe (a, [String])

With this type, fail will give Nothing, and only is non-failing cases
will there be a [String] to present. (No good for logging!)

testa == Nothing
-}</font>

<font color=Blue>{- 
type B a = MaybeT (Writer [String]) a ~= Writer [String] (Maybe a) 
        ~= (Maybe a, [String])

With this type, there will always be a String as the second component
of the pair, even when fail gives a Nothing as the first component.

testb == (Nothing,["I fail"])

-}</font>


<u><font color="#804000">instance</font></u> <font color="#808080">(</font><font color=Green>Monoid</font> w<font color="#808080">,</font> <font color=Green>MonadWriter</font> w m<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>MonadWriter</font> w <font color="#808080">(</font><font color=Green>MaybeT</font> m<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  tell    <font color="#808080">=</font>  tellMT
  listen  <font color="#808080">=</font>  listenMT
  pass    <font color="#808080">=</font>  error <font color=Magenta>"pass is not part of the exam question"</font>

tellMT   <font color="#808080">::</font> <font color=Green>MonadWriter</font> w m <font color="#808080">=&gt;</font> w <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m <font color=Green>()</font>
tellMT w <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#800080">$</font> tellMT1 w

<font color=Blue>-- I'm adding type annotations just to clarify a bit.</font>
tellMT1  <font color="#808080">::</font> <font color=Green>MonadWriter</font> w m <font color="#808080">=&gt;</font> w <font color="#808080">-&gt;</font> m <font color="#808080">(</font><font color=Green>Maybe</font> <font color=Green>()</font><font color="#808080">)</font>
tellMT1 w <font color="#808080">=</font> tell w <font color="#800080">&gt;&gt;</font> return <font color="#808080">(</font><font color=Green>Just</font> <font color=Green>()</font><font color="#808080">)</font>

listenMT <font color="#808080">::</font> <font color=Green>MonadWriter</font> w m <font color="#808080">=&gt;</font> <font color=Green>MaybeT</font> m a <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m <font color="#808080">(</font>a<font color="#808080">,</font> w<font color="#808080">)</font>
listenMT <font color="#808080">(</font><font color=Green>MaybeT</font> mMa<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#800080">$</font> listenMT1 mMa

listenMT1 <font color="#808080">::</font> <font color=Green>MonadWriter</font> w m <font color="#808080">=&gt;</font> m <font color="#808080">(</font><font color=Green>Maybe</font> a<font color="#808080">)</font> <font color="#808080">-&gt;</font> m <font color="#808080">(</font><font color=Green>Maybe</font> <font color="#808080">(</font>a<font color="#808080">,</font> w<font color="#808080">)</font><font color="#808080">)</font>
listenMT1 mma <font color="#808080">=</font> <u><font color="#804000">do</font></u> <font color="#808080">(</font>ma<font color="#808080">,</font> w<font color="#808080">)</font> <font color="#808080">&lt;-</font> listen mma
                   return <font color="#800080">$</font> <u><font color="#804000">case</font></u> ma <u><font color="#804000">of</font></u>
                     <font color=Green>Nothing</font> <font color="#808080">-&gt;</font> <font color=Green>Nothing</font>
                     <font color=Green>Just</font> a  <font color="#808080">-&gt;</font> <font color=Green>Just</font> <font color="#808080">(</font>a<font color="#808080">,</font> w<font color="#808080">)</font>

<font color=Blue>----------------------------------------------------------------</font>
main <font color="#808080">=</font> <u><font color="#804000">do</font></u> 
  print <font color="#800080">$</font> testa <font color="#800080">==</font> <font color=Green>Nothing</font>
  print <font color="#800080">$</font> testb <font color="#800080">==</font> <font color="#808080">(</font><font color=Green>Nothing</font><font color="#808080">,</font><font color="#808080">[</font><font color=Magenta>"I fail"</font><font color="#808080">]</font><font color="#808080">)</font>
</pre>
</body>
</html>