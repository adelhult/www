<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-20110316/Problem3.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE GADTs #-}</font>
<u><font color="#804000">module</font></u> <font color=Green>Problem2</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font>
<u><font color="#804000">import</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font>

<u><font color="#804000">data</font></u> <font color=Green>Parser</font> tok a <u><font color="#804000">where</font></u>
  <font color=Green>Zero</font>     <font color="#808080">::</font>                                   <font color=Green>Parser</font> tok  <font color=Green>()</font>
  <font color=Green>One</font>      <font color="#808080">::</font>                                   <font color=Green>Parser</font> tok  <font color=Green>()</font>
  <font color=Green>Check</font>    <font color="#808080">::</font>  <font color="#808080">(</font>tok   <font color="#808080">-&gt;</font> <font color=Green>Bool</font><font color="#808080">)</font> <font color="#808080">-&gt;</font>               <font color=Green>Parser</font> tok  tok
  <font color=Green>Satisfy</font>  <font color="#808080">::</font>  <font color="#808080">(</font><font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font><font color="#808080">)</font> <font color="#808080">-&gt;</font>               <font color=Green>Parser</font> tok  <font color="#808080">[</font>tok<font color="#808080">]</font>
  <font color=Green>Push</font>     <font color="#808080">::</font>  tok <font color="#808080">-&gt;</font> <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font>           <font color=Green>Parser</font> tok  a
  <font color=Green>Plus</font>     <font color="#808080">::</font>  <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font> <font color=Green>Parser</font> tok b <font color="#808080">-&gt;</font>  <font color=Green>Parser</font> tok  <font color="#808080">(</font><font color=Green>Either</font> a b<font color="#808080">)</font>
  <font color=Green>Times</font>    <font color="#808080">::</font>  <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font> <font color=Green>Parser</font> tok b <font color="#808080">-&gt;</font>  <font color=Green>Parser</font> tok  <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font>
  <font color=Green>Star</font>     <font color="#808080">::</font>  <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font>                  <font color=Green>Parser</font> tok  <font color="#808080">[</font>a<font color="#808080">]</font>
    
parse <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font> <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font> <font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> m a
 
<font color=Blue>-- |Zero| always fails.</font>
parse <font color=Green>Zero</font> ts <font color="#808080">=</font> mzero
 
<font color=Blue>-- |One| matches only the empty string.</font>
parse <font color=Green>One</font> <font color=Green>[]</font>  <font color="#808080">=</font>  return <font color=Green>()</font>
parse <font color=Green>One</font> <u><font color="#804000">_</font></u>   <font color="#808080">=</font>  mzero
 
<font color=Blue>-- |Check p| matches a string with exactly one token |t| such that |p t| holds.</font>
parse <font color="#808080">(</font><font color=Green>Check</font> p<font color="#808080">)</font> <font color="#808080">[</font>t<font color="#808080">]</font>  <font color="#808080">=</font>  <u><font color="#804000">if</font></u> p t <u><font color="#804000">then</font></u> return t <u><font color="#804000">else</font></u> mzero
parse <font color="#808080">(</font><font color=Green>Check</font> p<font color="#808080">)</font> <u><font color="#804000">_</font></u>    <font color="#808080">=</font>  mzero
 
<font color=Blue>-- |Satisfy p| matches any string such that |p ts| holds.</font>
parse <font color="#808080">(</font><font color=Green>Satisfy</font> p<font color="#808080">)</font> xs <font color="#808080">=</font> <u><font color="#804000">if</font></u> p xs <u><font color="#804000">then</font></u> return xs <u><font color="#804000">else</font></u> mzero
 
<font color=Blue>-- |Push t p| matches a string |ts| when |p| matches |(t:ts)|.</font>
parse <font color="#808080">(</font><font color=Green>Push</font> t p<font color="#808080">)</font> ts <font color="#808080">=</font> parse p <font color="#808080">(</font>t<b><font color="#800080">:</font></b>ts<font color="#808080">)</font>
 
<font color=Blue>-- |Plus p q| matches when either |p| or |q| does.</font>
parse <font color="#808080">(</font><font color=Green>Plus</font> p q<font color="#808080">)</font> ts <font color="#808080">=</font>  liftM <font color=Green>Left</font>   <font color="#808080">(</font>parse p ts<font color="#808080">)</font> <font color="#800080">`mplus`</font> 
                       liftM <font color=Green>Right</font>  <font color="#808080">(</font>parse q ts<font color="#808080">)</font>
 
<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Solution to 3a)</font>

<font color=Blue>-- |Times p q| matches the concatenation of |p| and |q|.</font>
parse <font color="#808080">(</font><font color=Green>Times</font> p q<font color="#808080">)</font> ts <font color="#808080">=</font> parseTimes p q ts
 
<font color=Blue>-- |Star p| matches zero or more copies of |p|.</font>
parse <font color="#808080">(</font><font color=Green>Star</font> p<font color="#808080">)</font> ts <font color="#808080">=</font> parseStar p ts

parseStar <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font> <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font> <font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> m <font color="#808080">[</font>a<font color="#808080">]</font>
parseStar p <font color=Green>[]</font>      <font color="#808080">=</font> return <font color=Green>[]</font>
parseStar p <font color="#808080">(</font>t<b><font color="#800080">:</font></b>ts<font color="#808080">)</font>  <font color="#808080">=</font> <u><font color="#804000">do</font></u>
    <font color="#808080">(</font>v<font color="#808080">,</font>vs<font color="#808080">)</font> <font color="#808080">&lt;-</font> parse <font color="#808080">(</font><font color=Green>Times</font> p <font color="#808080">(</font><font color=Green>Star</font> p<font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">(</font>t<b><font color="#800080">:</font></b>ts<font color="#808080">)</font>
    return <font color="#808080">(</font>v<b><font color="#800080">:</font></b>vs<font color="#808080">)</font>
    
parseTimes <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font>
  <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font> <font color=Green>Parser</font> tok b <font color="#808080">-&gt;</font> <font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> m <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font>
parseTimes p q <font color=Green>[]</font>      <font color="#808080">=</font> liftM2 <font color=Green>(,)</font> <font color="#808080">(</font>parse p <font color=Green>[]</font><font color="#808080">)</font> <font color="#808080">(</font>parse q <font color=Green>[]</font><font color="#808080">)</font>
parseTimes p q <font color="#808080">(</font>t<b><font color="#800080">:</font></b>ts<font color="#808080">)</font>  <font color="#808080">=</font> 
    parse <font color="#808080">(</font><font color=Green>Times</font> <font color="#808080">(</font><font color=Green>Push</font> t p<font color="#808080">)</font> q<font color="#808080">)</font> ts  <font color="#800080">`mplus`</font>
    liftM2 <font color=Green>(,)</font> <font color="#808080">(</font>parse p <font color=Green>[]</font><font color="#808080">)</font> <font color="#808080">(</font>parse q <font color="#808080">(</font>t<b><font color="#800080">:</font></b>ts<font color="#808080">)</font><font color="#808080">)</font>
 
<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Solution to 3b)</font>
    
<u><font color="#804000">newtype</font></u> <font color=Green>P</font> m tok a <font color="#808080">=</font> <font color=Green>P</font> <font color="#808080">{</font>runP <font color="#808080">::</font> <font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> m a<font color="#808080">}</font>
 
zero     <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font>                                   <font color=Green>P</font> m tok  <font color=Green>()</font>
one      <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font>                                   <font color=Green>P</font> m tok  <font color=Green>()</font>
check    <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font>  <font color="#808080">(</font>tok   <font color="#808080">-&gt;</font> <font color=Green>Bool</font><font color="#808080">)</font> <font color="#808080">-&gt;</font>               <font color=Green>P</font> m tok  tok
satisfy  <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font>  <font color="#808080">(</font><font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font><font color="#808080">)</font> <font color="#808080">-&gt;</font>               <font color=Green>P</font> m tok  <font color="#808080">[</font>tok<font color="#808080">]</font>
plus     <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font>  <font color=Green>P</font> m tok a <font color="#808080">-&gt;</font> <font color=Green>P</font> m tok b <font color="#808080">-&gt;</font>  <font color=Green>P</font> m tok  <font color="#808080">(</font><font color=Green>Either</font> a b<font color="#808080">)</font>
zero    <font color="#808080">=</font> <font color=Green>P</font> <font color="#808080">(</font>const mzero<font color="#808080">)</font>
one     <font color="#808080">=</font> <font color=Green>P</font> <font color="#808080">(</font><font color="#808080">\</font>xs <font color="#808080">-&gt;</font> <u><font color="#804000">if</font></u> null xs <u><font color="#804000">then</font></u> return <font color=Green>()</font> <u><font color="#804000">else</font></u> mzero<font color="#808080">)</font>
check   p <font color="#808080">=</font> <font color=Green>P</font> <font color="#808080">(</font><font color="#808080">\</font>xs <font color="#808080">-&gt;</font> <u><font color="#804000">let</font></u> n <font color="#808080">=</font> length xs<font color="#808080">;</font> x <font color="#808080">=</font> head xs 
                      <u><font color="#804000">in</font></u> <u><font color="#804000">if</font></u> n<font color="#800080">==</font><font color=Magenta>1</font> <font color="#800080">&amp;&amp;</font> p x <u><font color="#804000">then</font></u> return x <u><font color="#804000">else</font></u> mzero<font color="#808080">)</font>
satisfy p <font color="#808080">=</font> <font color=Green>P</font> <font color="#808080">(</font><font color="#808080">\</font>xs <font color="#808080">-&gt;</font> <u><font color="#804000">if</font></u> p xs <u><font color="#804000">then</font></u> return xs <u><font color="#804000">else</font></u> mzero<font color="#808080">)</font>
plus    <font color="#808080">(</font><font color=Green>P</font> p<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>P</font> q<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>P</font> <font color="#808080">(</font><font color="#808080">\</font>xs <font color="#808080">-&gt;</font> liftM <font color=Green>Left</font> <font color="#808080">(</font>p xs<font color="#808080">)</font> <font color="#800080">`mplus`</font> liftM <font color=Green>Right</font> <font color="#808080">(</font>q xs<font color="#808080">)</font><font color="#808080">)</font>

<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Below is some testing code and some variant solutions copied from</font>
<font color=Blue>-- students (not guaranteed to work).</font>

<font color=Blue>-- Examples: (not part of the exam question)</font>

<font color=Blue>-- Looping test:</font>
test <font color="#808080">::</font> <font color=Green>Maybe</font> <font color="#808080">[</font><font color=Green>()</font><font color="#808080">]</font>
test <font color="#808080">=</font> parse <font color="#808080">(</font><font color=Green>Star</font> <font color=Green>One</font><font color="#808080">)</font> <font color=Magenta>"I really must get to the bottom of this..."</font>

token x <font color="#808080">=</font> <font color=Green>Check</font> <font color="#808080">(</font>x <font color="#800080">==</font><font color="#808080">)</font>
string xs <font color="#808080">=</font> <font color=Green>Satisfy</font> <font color="#808080">(</font>xs <font color="#800080">==</font><font color="#808080">)</font>
 
p   <font color="#808080">=</font>  <font color=Green>Times</font> <font color="#808080">(</font>token <font color=Magenta>'a'</font><font color="#808080">)</font> <font color="#808080">(</font>token <font color=Magenta>'b'</font><font color="#808080">)</font>
p1  <font color="#808080">=</font>  <font color=Green>Times</font> <font color="#808080">(</font><font color=Green>Star</font> <font color="#808080">(</font>token <font color=Magenta>'a'</font><font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Star</font> <font color="#808080">(</font>token <font color=Magenta>'b'</font><font color="#808080">)</font><font color="#808080">)</font>
p2  <font color="#808080">=</font>  <font color=Green>Star</font> p1
 
blocks <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Eq</font> tok<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>Parser</font> tok <font color="#808080">[</font><font color="#808080">[</font>tok<font color="#808080">]</font><font color="#808080">]</font>
blocks <font color="#808080">=</font> <font color=Green>Star</font> <font color="#808080">(</font><font color=Green>Satisfy</font> allEqual<font color="#808080">)</font>
    <u><font color="#804000">where</font></u> allEqual xs <font color="#808080">=</font> and <font color="#808080">(</font>zipWith <font color="#808080">(</font><font color="#800080">==</font><font color="#808080">)</font> xs <font color="#808080">(</font>drop <font color=Magenta>1</font> xs<font color="#808080">)</font><font color="#808080">)</font>
 
evenOdd <font color="#808080">=</font> <font color=Green>Plus</font> <font color="#808080">(</font><font color=Green>Star</font> <font color="#808080">(</font><font color=Green>Times</font> <font color="#808080">(</font><font color=Green>Check</font> even<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Check</font> odd<font color="#808080">)</font><font color="#808080">)</font><font color="#808080">)</font>
               <font color="#808080">(</font><font color=Green>Star</font> <font color="#808080">(</font><font color=Green>Times</font> <font color="#808080">(</font><font color=Green>Check</font> odd<font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Check</font> even<font color="#808080">)</font><font color="#808080">)</font><font color="#808080">)</font>
          

<font color=Blue>----------------</font>
<font color=Blue>-- a very rudimentary test suite:</font>
test1 xs <font color="#808080">=</font> parse p xs  <font color="#800080">==</font>  <u><font color="#804000">if</font></u> xs <font color="#800080">==</font> <font color=Magenta>"ab"</font> <u><font color="#804000">then</font></u> <font color=Green>Just</font> <font color="#808080">(</font><font color=Magenta>'a'</font><font color="#808080">,</font><font color=Magenta>'b'</font><font color="#808080">)</font> <u><font color="#804000">else</font></u> <font color=Green>Nothing</font>
test2 xs <font color="#808080">=</font> <u><font color="#804000">if</font></u> null rest 
           <u><font color="#804000">then</font></u> label <font color=Magenta>"Just"</font> <font color="#800080">$</font> <font color=Green>Just</font> <font color="#808080">(</font><u><font color="#804000">as</font></u><font color="#808080">,</font> bs<font color="#808080">)</font> <font color="#800080">==</font> parse p1 xs
           <u><font color="#804000">else</font></u> label <font color=Magenta>"triv"</font> <font color="#800080">$</font> <font color=Green>Nothing</font> <font color="#800080">==</font> parse p1 xs
    <u><font color="#804000">where</font></u> <font color="#808080">(</font><u><font color="#804000">as</font></u><font color="#808080">,</font> bs'<font color="#808080">)</font> <font color="#808080">=</font> <font color="#808080">(</font>takeWhile <font color="#808080">(</font><font color=Magenta>'a'</font><font color="#800080">==</font><font color="#808080">)</font> xs<font color="#808080">,</font> dropWhile <font color="#808080">(</font><font color=Magenta>'a'</font><font color="#800080">==</font><font color="#808080">)</font> xs<font color="#808080">)</font>
          <font color="#808080">(</font>bs<font color="#808080">,</font> rest<font color="#808080">)</font><font color="#808080">=</font> <font color="#808080">(</font>takeWhile <font color="#808080">(</font><font color=Magenta>'b'</font><font color="#800080">==</font><font color="#808080">)</font> xs<font color="#808080">,</font> dropWhile <font color="#808080">(</font><font color=Magenta>'b'</font><font color="#800080">==</font><font color="#808080">)</font> xs<font color="#808080">)</font>

<font color=Blue>-- This test depends on the choice / order of matches</font>
test3 <font color="#808080">=</font> parse p2 <font color=Magenta>"aaabbbbaabbbbbbbaaabbabab"</font> <font color="#800080">==</font>  
        <font color=Green>Just</font> <font color="#808080">[</font><font color="#808080">(</font><font color=Magenta>"aaa"</font><font color="#808080">,</font><font color=Magenta>"bbbb"</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>"aa"</font><font color="#808080">,</font><font color=Magenta>"bbbbbbb"</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>"aaa"</font><font color="#808080">,</font><font color=Magenta>"bb"</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>"a"</font><font color="#808080">,</font><font color=Magenta>"b"</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>"a"</font><font color="#808080">,</font><font color=Magenta>"b"</font><font color="#808080">)</font><font color="#808080">]</font>
<font color=Blue>-- This test depends on the choice / order of matches</font>
test4 <font color="#808080">=</font> parse blocks <font color=Magenta>"aaaabbbbbbbbcccccddd"</font> <font color="#800080">==</font>
        <font color=Green>Just</font> <font color="#808080">[</font><font color=Magenta>"aaaa"</font><font color="#808080">,</font><font color=Magenta>"bbbbbbbb"</font><font color="#808080">,</font><font color=Magenta>"ccccc"</font><font color="#808080">,</font><font color=Magenta>"ddd"</font><font color="#808080">]</font>
test5 <font color="#808080">=</font> parse evenOdd <font color="#808080">[</font><font color=Magenta>0</font><font color="#808080">..</font><font color=Magenta>9</font><font color="#808080">]</font> <font color="#800080">==</font>
        <font color=Green>Just</font> <font color="#808080">(</font><font color=Green>Left</font> <font color="#808080">[</font><font color="#808080">(</font><font color=Magenta>0</font><font color="#808080">,</font><font color=Magenta>1</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>2</font><font color="#808080">,</font><font color=Magenta>3</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>4</font><font color="#808080">,</font><font color=Magenta>5</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>6</font><font color="#808080">,</font><font color=Magenta>7</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>8</font><font color="#808080">,</font><font color=Magenta>9</font><font color="#808080">)</font><font color="#808080">]</font><font color="#808080">)</font>
test6 <font color="#808080">=</font> parse evenOdd <font color="#808080">[</font><font color=Magenta>1</font><font color="#808080">..</font><font color=Magenta>10</font><font color="#808080">]</font> <font color="#800080">==</font>
        <font color=Green>Just</font> <font color="#808080">(</font><font color=Green>Right</font> <font color="#808080">[</font><font color="#808080">(</font><font color=Magenta>1</font><font color="#808080">,</font><font color=Magenta>2</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>3</font><font color="#808080">,</font><font color=Magenta>4</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>5</font><font color="#808080">,</font><font color=Magenta>6</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>7</font><font color="#808080">,</font><font color=Magenta>8</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color=Magenta>9</font><font color="#808080">,</font><font color=Magenta>10</font><font color="#808080">)</font><font color="#808080">]</font><font color="#808080">)</font>

main <font color="#808080">=</font> <u><font color="#804000">do</font></u> quickCheck test1
          quickCheck test2
          print <font color="#800080">$</font> test3 <font color="#800080">&amp;&amp;</font> test4 <font color="#800080">&amp;&amp;</font> test5 <font color="#800080">&amp;&amp;</font> test6
          
mconcat <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font> <font color="#808080">[</font>m a<font color="#808080">]</font> <font color="#808080">-&gt;</font> m a
mconcat <font color="#808080">=</font> foldr mplus mzero

parseTimes2 <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font> 
  <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font> <font color=Green>Parser</font> tok b <font color="#808080">-&gt;</font> <font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> m <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font>
parseTimes2 p q ts <font color="#808080">=</font> mconcat <u><font color="#804000">as</font></u>
  <u><font color="#804000">where</font></u> <u><font color="#804000">as</font></u> <font color="#808080">=</font> <font color="#808080">[</font> liftM2 <font color=Green>(,)</font> <font color="#808080">(</font>parse p pre<font color="#808080">)</font> <font color="#808080">(</font>parse q suf<font color="#808080">)</font>
             <font color="#808080">|</font> <font color="#808080">(</font>pre<font color="#808080">,</font>suf<font color="#808080">)</font> <font color="#808080">&lt;-</font> preAndSuf ts
             <font color="#808080">]</font>

preAndSuf <font color="#808080">::</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font><font color="#808080">(</font><font color="#808080">[</font>a<font color="#808080">]</font><font color="#808080">,</font><font color="#808080">[</font>a<font color="#808080">]</font><font color="#808080">)</font><font color="#808080">]</font>
preAndSuf xs <font color="#808080">=</font> <font color="#808080">[</font> splitAt n xs <font color="#808080">|</font> n <font color="#808080">&lt;-</font> <font color="#808080">[</font><font color=Magenta>0</font><font color="#808080">..</font>length xs<font color="#808080">]</font> <font color="#808080">]</font>

parseTimes3 <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font> 
  <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font> <font color=Green>Parser</font> tok b <font color="#808080">-&gt;</font> <font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> m <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font>
parseTimes3 p q ts <font color="#808080">=</font> mconcat <font color="#808080">[</font> <u><font color="#804000">do</font></u> a <font color="#808080">&lt;-</font> parse p <font color="#808080">(</font>take i ts<font color="#808080">)</font>
                                  b <font color="#808080">&lt;-</font> parse q <font color="#808080">(</font>drop i ts<font color="#808080">)</font>
                                  return <font color="#808080">(</font>a<font color="#808080">,</font> b<font color="#808080">)</font>
                             <font color="#808080">|</font> i <font color="#808080">&lt;-</font> <font color="#808080">[</font><font color=Magenta>0</font><font color="#808080">..</font>length ts<font color="#808080">]</font> <font color="#808080">]</font>


parseStar2 <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font> <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font> <font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> m <font color="#808080">[</font>a<font color="#808080">]</font>
parseStar2 p ts <font color="#808080">=</font> 
    <font color="#808080">(</font><u><font color="#804000">if</font></u> null ts <u><font color="#804000">then</font></u> return <font color=Green>[]</font> <u><font color="#804000">else</font></u> mzero<font color="#808080">)</font> <font color="#800080">`mplus`</font> 
    liftM <font color="#808080">(</font>uncurry <font color="#808080">(</font><b><font color="#800080">:</font></b><font color="#808080">)</font><font color="#808080">)</font> <font color="#808080">(</font>parse <font color="#808080">(</font><font color=Green>Times</font> p <font color="#808080">(</font><font color=Green>Star</font> p<font color="#808080">)</font><font color="#808080">)</font> ts<font color="#808080">)</font>

parseStar3 <font color="#808080">::</font> <font color=Green>MonadPlus</font> m <font color="#808080">=&gt;</font> <font color=Green>Parser</font> tok a <font color="#808080">-&gt;</font> <font color="#808080">[</font>tok<font color="#808080">]</font> <font color="#808080">-&gt;</font> m <font color="#808080">[</font>a<font color="#808080">]</font>
parseStar3 p <font color=Green>[]</font> <font color="#808080">=</font> return <font color=Green>[]</font>
parseStar3 p ts <font color="#808080">=</font> mconcat <font color="#808080">[</font> <u><font color="#804000">do</font></u> a  <font color="#808080">&lt;-</font> parse p        <font color="#808080">(</font>take i ts<font color="#808080">)</font>
                               <u><font color="#804000">as</font></u> <font color="#808080">&lt;-</font> parse <font color="#808080">(</font><font color=Green>Star</font> p<font color="#808080">)</font> <font color="#808080">(</font>drop i ts<font color="#808080">)</font>
                               return <font color="#808080">(</font>a<b><font color="#800080">:</font></b><u><font color="#804000">as</font></u><font color="#808080">)</font>
                          <font color="#808080">|</font> i <font color="#808080">&lt;-</font> <font color="#808080">[</font><font color=Magenta>1</font><font color="#808080">..</font>length ts<font color="#808080">]</font> <font color="#808080">]</font>


test7 xs <font color="#808080">=</font> parseTimes3 p q xs <font color="#800080">==</font> <font color="#808080">(</font>parseTimes p q xs <font color="#808080">::</font> <font color=Green>Maybe</font> <font color="#808080">(</font><font color=Green>Char</font><font color="#808080">,</font> <font color=Green>Char</font><font color="#808080">)</font><font color="#808080">)</font>
  <u><font color="#804000">where</font></u> p <font color="#808080">=</font> <font color=Green>Check</font> <font color="#808080">(</font><font color=Magenta>'o'</font><font color="#800080">&lt;</font><font color="#808080">)</font>
        q <font color="#808080">=</font> <font color=Green>Check</font> <font color="#808080">(</font><font color=Magenta>'o'</font><font color="#800080">&gt;=</font><font color="#808080">)</font>

test8 xs <font color="#808080">=</font> parseStar p xs <font color="#800080">==</font> <font color="#808080">(</font>parseStar3 p xs <font color="#808080">::</font> <font color=Green>Maybe</font> <font color=Green>String</font><font color="#808080">)</font>
  <u><font color="#804000">where</font></u> p <font color="#808080">=</font> <font color=Green>Check</font> <font color="#808080">(</font><font color=Magenta>'o'</font><font color="#800080">&lt;</font><font color="#808080">)</font>

</pre>
</body>
</html>