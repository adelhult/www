<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-2013-08/DSL.hs</title>
</head>
<body>
<pre><u><font color="#804000">module</font></u> <font color=Green>DSL</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>Prelude</font> hiding <font color="#808080">(</font>sequence<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font> <u><font color="#804000">as</font></u> <font color=Green>CMS</font> hiding <font color="#808080">(</font>sequence<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>System</font><font color="#800080">.</font><font color=Green>Random</font> <font color="#808080">(</font><font color=Green>StdGen</font><font color="#808080">,</font> randomR<font color="#808080">,</font> newStdGen<font color="#808080">)</font>

<u><font color="#804000">type</font></u> <font color=Green>Sem</font> a <font color="#808080">=</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>State</font> <font color=Green>StdGen</font> a

<font color=Blue>-- |nextBoundedBy bound| for |0 &lt; bound| returns a random result |0 &lt;= result &lt; bound|</font>
nextBoundedBy <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>Sem</font> <font color=Green>Int</font>
nextBoundedBy bound <font color="#808080">=</font> state <font color="#800080">$</font> randomR <font color="#808080">(</font><font color=Magenta>0</font><font color="#808080">,</font>bound<font color=Blue>-</font><font color=Magenta>1</font><font color="#808080">)</font>
  <font color=Blue>-- Not asked for in the exam question</font>

<font color=Blue>-- a)</font>

elements     <font color="#808080">=</font> oneof <font color="#800080">.</font> map returnGen

oneof        <font color="#808080">=</font> frequency <font color="#800080">.</font> map <font color="#808080">(</font><font color=Green>(,)</font> <font color=Magenta>1</font><font color="#808080">)</font> <font color=Blue>-- Alternatively: zip (repeat 1)</font>

fmapGen f g  <font color="#808080">=</font> bindGen g <font color="#800080">$</font> <font color="#808080">\</font>x <font color="#808080">-&gt;</font> return <font color="#800080">$</font> f x

sequence <font color=Green>[]</font>      <font color="#808080">=</font> returnGen <font color=Green>[]</font>
sequence <font color="#808080">(</font>g<b><font color="#800080">:</font></b>gs<font color="#808080">)</font>  <font color="#808080">=</font> bindGen g <font color="#800080">$</font> <font color="#808080">\</font>x <font color="#808080">-&gt;</font> bindGen <font color="#808080">(</font>sequence gs<font color="#808080">)</font> <font color="#800080">$</font> <font color="#808080">\</font>xs <font color="#808080">-&gt;</font> return <font color="#808080">(</font>x<b><font color="#800080">:</font></b>xs<font color="#808080">)</font>

<font color=Blue>-- b)</font>

<u><font color="#804000">type</font></u> <font color=Green>Gen</font> a <font color="#808080">=</font> <font color=Green>Sem</font> a

returnGen a <font color="#808080">=</font> <font color=Green>CMS</font><font color="#800080">.</font>state <font color="#800080">$</font> <font color="#808080">\</font>s <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">,</font> s<font color="#808080">)</font>

bindGen g f <font color="#808080">=</font> <font color=Green>CMS</font><font color="#800080">.</font>state <font color="#800080">$</font> <font color="#808080">\</font>s <font color="#808080">-&gt;</font> <u><font color="#804000">let</font></u> <font color="#808080">(</font>a<font color="#808080">,</font> s'<font color="#808080">)</font> <font color="#808080">=</font> runState g s <u><font color="#804000">in</font></u> runState <font color="#808080">(</font>f a<font color="#808080">)</font> s'

frequency igs <font color="#808080">=</font> <u><font color="#804000">do</font></u>  <u><font color="#804000">let</font></u> tot <font color="#808080">=</font> sum <font color="#800080">$</font> map fst igs
                    j <font color="#808080">&lt;-</font> nextBoundedBy tot    
                    pick j igs
                   
pick <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font><font color="#808080">(</font><font color=Green>Int</font><font color="#808080">,</font> a<font color="#808080">)</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> a
pick j <font color=Green>[]</font> <font color="#808080">=</font> error <font color=Magenta>"pick: Out of bound"</font>
pick j <font color="#808080">(</font><font color="#808080">(</font>i<font color="#808080">,</font> a<font color="#808080">)</font><b><font color="#800080">:</font></b>ias<font color="#808080">)</font> <font color="#808080">|</font> j <font color="#800080">&lt;</font> i      <font color="#808080">=</font> a
                    <font color="#808080">|</font> otherwise  <font color="#808080">=</font> pick <font color="#808080">(</font>j<font color=Blue>-</font>i<font color="#808080">)</font> ias
                         
run <font color="#808080">::</font> <font color=Green>Gen</font> a <font color="#808080">-&gt;</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>StdGen</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font>      
run g n <font color="#808080">=</font> take n <font color="#800080">.</font> runInf g

runInf <font color="#808080">::</font> <font color=Green>State</font> s a <font color="#808080">-&gt;</font> s <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font>
runInf g <font color="#808080">=</font> evalState <font color="#808080">(</font>sequence <font color="#800080">$</font> repeat g<font color="#808080">)</font>

<font color=Blue>----</font>
<font color=Blue>-- Testing code - not part of the exam question</font>
runIO <font color="#808080">::</font> <font color=Green>Gen</font> a <font color="#808080">-&gt;</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>IO</font> <font color="#808080">[</font>a<font color="#808080">]</font>
runIO g n <font color="#808080">=</font> run g n <font color="#800080">`fmap`</font> newStdGen

test <font color="#808080">=</font> runIO <font color="#808080">(</font>frequency 
  <font color="#808080">[</font> <font color="#808080">(</font><font color=Magenta>3</font><font color="#808080">,</font> return <font color=Green>False</font><font color="#808080">)</font><font color="#808080">,</font>
    <font color="#808080">(</font><font color=Magenta>1</font><font color="#808080">,</font>return <font color=Green>True</font><font color="#808080">)</font>
  <font color="#808080">]</font><font color="#808080">)</font> <font color=Magenta>10</font>
</pre>
</body>
</html>