<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-2013-08/Types.hs</title>
</head>
<body>
<pre><font color=Blue>-- First some code provided in the exam question (from RWH ch18)</font>
<u><font color="#804000">module</font></u> <font color=Green>Types</font> <font color="#808080">(</font>listDirectory<font color="#808080">,</font> countEntries<font color="#808080">)</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>System</font><font color="#800080">.</font><font color=Green>Directory</font> <font color="#808080">(</font>doesDirectoryExist<font color="#808080">,</font> getDirectoryContents<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>System</font><font color="#800080">.</font><font color=Green>FilePath</font> <font color="#808080">(</font><font color="#808080">(</font><font color="#800080">&lt;/&gt;</font><font color="#808080">)</font><font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font> <font color="#808080">(</font>forM_<font color="#808080">,</font> when<font color="#808080">,</font> liftM<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Trans</font> <font color="#808080">(</font>liftIO<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Writer</font> <font color="#808080">(</font><font color=Green>WriterT</font><font color="#808080">,</font> tell<font color="#808080">,</font> execWriterT<font color="#808080">)</font>

listDirectory <font color="#808080">::</font> <font color=Green>FilePath</font> <font color="#808080">-&gt;</font> <font color=Green>IO</font> <font color="#808080">[</font><font color=Green>String</font><font color="#808080">]</font>
listDirectory <font color="#808080">=</font> liftM <font color="#808080">(</font>filter notDots<font color="#808080">)</font> <font color="#800080">.</font> getDirectoryContents
    <u><font color="#804000">where</font></u> notDots p <font color="#808080">=</font> p <font color="#800080">/=</font> <font color=Magenta>"."</font> <font color="#800080">&amp;&amp;</font> p <font color="#800080">/=</font> <font color=Magenta>".."</font>

countEntries <font color="#808080">::</font> <font color=Green>FilePath</font> <font color="#808080">-&gt;</font> <font color=Green>WriterT</font> <font color="#808080">[</font><font color="#808080">(</font><font color=Green>FilePath</font><font color="#808080">,</font> <font color=Green>Int</font><font color="#808080">)</font><font color="#808080">]</font> <font color=Green>IO</font> <font color=Green>()</font>
countEntries path <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  contents <font color="#808080">&lt;-</font> liftIO <font color="#800080">.</font> listDirectory <font color="#800080">$</font> path
  tell <font color="#808080">[</font><font color="#808080">(</font>path<font color="#808080">,</font> length contents<font color="#808080">)</font><font color="#808080">]</font>
  forM_ contents <font color="#800080">$</font> <font color="#808080">\</font>name <font color="#808080">-&gt;</font> <u><font color="#804000">do</font></u>
    <u><font color="#804000">let</font></u> newName <font color="#808080">=</font> path <font color="#800080">&lt;/&gt;</font> name
    isDir <font color="#808080">&lt;-</font> liftIO <font color="#800080">.</font> doesDirectoryExist <font color="#800080">$</font> newName
    when isDir <font color="#800080">$</font> countEntries newName

<font color=Blue>-- Then a solution to the first subproblem</font>

<font color=Blue>-- a) </font>
    
test <font color="#808080">=</font> execWriterT <font color="#808080">(</font>countEntries <font color=Magenta>"T"</font><font color="#808080">)</font> <font color="#800080">&gt;&gt;=</font> print
<font color=Blue>-- Output: [("T",2),("T/D",1),("T/A",2)]</font>
<font color=Blue>-- or      [("T",2),("T/A",2),("T/D",1)]</font>


<font color=Blue>{- 

At the top level, evaluation of |print|, |&gt;&gt;=| and |execWriterT|
forces the evaluation of |countEntries "T"|. The first call to
|listDirectory| returns |["A", "D"]| so that |tell| emits the pair
|("T", 2)| and the for-loop runs twice. In both runs the subdirectory
exists so |countEntries| is called recurively with |"T/A"| and with
|"T/D"|. These times |tell| emits |("T/A", 2)| and |("T/D", 1)| but
since there are no further subdirectories no further recursive calls
happen.

-}</font>

<font color=Blue>-- b) </font>

<font color=Blue>-- I assume that a "recursion depth" of &lt; 0 means "do nothing", depth</font>
<font color=Blue>-- 0 means work through this directory but no subdirectories, etc.</font>

countEntriesMax <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>FilePath</font> <font color="#808080">-&gt;</font> <font color=Green>WriterT</font> <font color="#808080">[</font><font color="#808080">(</font><font color=Green>FilePath</font><font color="#808080">,</font> <font color=Green>Int</font><font color="#808080">)</font><font color="#808080">]</font> <font color=Green>IO</font> <font color=Green>()</font>
countEntriesMax n path <font color="#808080">|</font> n <font color="#800080">&lt;</font> <font color=Magenta>0</font> <font color="#808080">=</font> return <font color=Green>()</font>          <font color=Blue>-- change</font>
                       <font color="#808080">|</font> otherwise <font color="#808080">=</font> <u><font color="#804000">do</font></u>             <font color=Blue>-- change</font>
  contents <font color="#808080">&lt;-</font> liftIO <font color="#800080">.</font> listDirectory <font color="#800080">$</font> path
  tell <font color="#808080">[</font><font color="#808080">(</font>path<font color="#808080">,</font> length contents<font color="#808080">)</font><font color="#808080">]</font>
  forM_ contents <font color="#800080">$</font> <font color="#808080">\</font>name <font color="#808080">-&gt;</font> <u><font color="#804000">do</font></u>
    <u><font color="#804000">let</font></u> newName <font color="#808080">=</font> path <font color="#800080">&lt;/&gt;</font> name
    isDir <font color="#808080">&lt;-</font> liftIO <font color="#800080">.</font> doesDirectoryExist <font color="#800080">$</font> newName
    when isDir <font color="#800080">$</font> countEntriesMax <font color="#808080">(</font>n<font color=Blue>-</font><font color=Magenta>1</font><font color="#808080">)</font> newName      <font color=Blue>-- change</font>
</pre>
</body>
</html>