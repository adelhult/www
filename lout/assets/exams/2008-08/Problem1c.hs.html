<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>exam-08aug/Problem1c.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE TypeSynonymInstances #-}</font>

<u><font color="#804000">module</font></u> <font color=Green>Problem1c</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Error</font>

<u><font color="#804000">class</font></u> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> <font color=Green>GameMonad</font> m <u><font color="#804000">where</font></u>
  extraLife  <font color="#808080">::</font> m <font color=Green>()</font>
  getLives   <font color="#808080">::</font> m <font color=Green>Int</font>
  checkPoint <font color="#808080">::</font> m a <font color="#808080">-&gt;</font> m a
  die        <font color="#808080">::</font> m a

<font color=Blue>-- We don't need any information in the errors. We could use</font>
<font color=Blue>-- the Maybe monad transformer [1] instead (credits to Ann</font>
<font color=Blue>-- Lilliestr√∂m for that solution).</font>
<u><font color="#804000">type</font></u> <font color=Green>GameT</font> m <font color="#808080">=</font> <font color=Green>ErrorT</font> <font color=Green>Err</font> <font color="#808080">(</font><font color=Green>StateT</font> <font color=Green>Lives</font> m<font color="#808080">)</font>

<u><font color="#804000">type</font></u> <font color=Green>Err</font>   <font color="#808080">=</font> <font color=Green>()</font>
<u><font color="#804000">type</font></u> <font color=Green>Lives</font> <font color="#808080">=</font> <font color=Green>Int</font>

<font color=Blue>-- There's no Error instance for ().</font>
<u><font color="#804000">instance</font></u> <font color=Green>Error</font> <font color=Green>()</font> <u><font color="#804000">where</font></u>
  noMsg    <font color="#808080">=</font> <font color=Green>()</font>
  strMsg <u><font color="#804000">_</font></u> <font color="#808080">=</font> <font color=Green>()</font>

<u><font color="#804000">instance</font></u> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> <font color=Green>GameMonad</font> <font color="#808080">(</font><font color=Green>GameT</font> m<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  extraLife    <font color="#808080">=</font> modify succ
  getLives     <font color="#808080">=</font> get
  die          <font color="#808080">=</font> modify pred <font color="#800080">&gt;&gt;</font> throwError <font color=Green>()</font>
  checkPoint m <font color="#808080">=</font> m <font color="#800080">`catchError`</font> <font color="#808080">\</font>e <font color="#808080">-&gt;</font> <u><font color="#804000">do</font></u>
    n <font color="#808080">&lt;-</font> getLives
    <u><font color="#804000">if</font></u> n <font color="#800080">&gt;</font> <font color=Magenta>0</font> <u><font color="#804000">then</font></u> checkPoint m
             <u><font color="#804000">else</font></u> throwError e

runGameT <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> <font color=Green>GameT</font> m a <font color="#808080">-&gt;</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> m <font color="#808080">(</font><font color=Green>Maybe</font> <font color="#808080">(</font>a<font color="#808080">,</font> <font color=Green>Int</font><font color="#808080">)</font><font color="#808080">)</font>
runGameT m n <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  <font color="#808080">(</font>r<font color="#808080">,</font> n<font color="#808080">)</font> <font color="#808080">&lt;-</font> runStateT <font color="#808080">(</font>runErrorT m<font color="#808080">)</font> n
  <u><font color="#804000">case</font></u> r <u><font color="#804000">of</font></u>
    <font color=Green>Left</font> <font color=Green>()</font> <font color="#808080">-&gt;</font> return <font color=Green>Nothing</font>
    <font color=Green>Right</font> x <font color="#808080">-&gt;</font> return <font color="#800080">$</font> <font color=Green>Just</font> <font color="#808080">(</font>x<font color="#808080">,</font> n<font color="#808080">)</font>

<font color=Blue>-- [1] <a href="http://www.haskell.org/haskellwiki/New_monads/MaybeT">http://www.haskell.org/haskellwiki/New_monads/MaybeT</a></font>

</pre>
</body>
</html>